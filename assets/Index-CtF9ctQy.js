import{c as ne,u as ie,r as l,j as e,B as _,X as qe,a as oe,s as k,b as M,d as Ga,e as ct,f as Gt,A as Ua,P as be,g as ye,h as S,D as Ut,C as Ka,i as ae,k as Kt,l as Va,m as Vt,n as qa,o as qt,p as Bt,R as Ba,q as Ht,t as Z,v as Ha,w as Wa}from"./index-Cy9nXAaZ.js";import{u as Qa,a as Se,b as Ya,c as Xa,d as Za,e as le,f as Fe,g as Pe,A as rt,h as nt,i as ot,j as Ja,k as it,l as er,m as tr,n as sr,o as ar,p as rr,U as nr,S as or,H as lr}from"./avatar-BOwSJDdi.js";import{I as L,c as Wt,R as cr,a as ir,L as U,s as Be,o as dr,n as Ie,l as ur}from"./types-D4JKRZ0C.js";import{C as He,S as q,a as B,b as H,c as W,d as G,P as We,h as Qt,u as Yt,F as Xt,R as Zt,e as dt,f as ut,g as Ot,i as mr,D as Ft}from"./DreamTeamSelector-CLeYz_u1.js";import{u as Qe,a as xr,b as mt,c as pr,d as Jt,e as fr,f as hr,g as gr,h as xt,i as yr,j as jr,k as Nr}from"./usePlayerStats-Drv2OJ02.js";import{T as es}from"./trophy-8NqlwKn2.js";import{u as ts,a as vr,b as br}from"./useTourTeams-F-6mGbpw.js";import{u as wr,a as ke}from"./index-yYffvkCE.js";import{u as _r,T as Cr}from"./useTourDreamTeamsBySeason-DcFby9Q_.js";import{C as pe,a as fe,b as he,c as ge}from"./card-CA5z_uMM.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=ne("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=ne("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=ne("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=ne("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=ne("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=ne("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=ne("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=ne("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=ne("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=ne("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function Rr(){const{isAdmin:t}=ie(),{data:a=[]}=Qa(),{data:s,isLoading:r}=Se(),n=Ya(),o=Xa(),i=Za(),[c,u]=l.useState(!1),[p,m]=l.useState(""),x=()=>{m((s==null?void 0:s.name)??""),u(!0)},f=()=>{s&&p.trim()&&o.mutate({id:s.id,name:p.trim()}),u(!1)},j=()=>{u(!1),m("")},N=()=>{n.mutate("ÐÐ¾Ð²Ñ‹Ð¹ ÑÐµÐ·Ð¾Ð½")},P=w=>{w!==(s==null?void 0:s.id)&&i.mutate(w)};return r?e.jsx("div",{className:"h-10 bg-secondary/50 rounded animate-pulse"}):s?e.jsxs("div",{className:"flex items-center gap-3 py-2 flex-wrap",children:[c?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(L,{value:p,onChange:w=>m(w.target.value),className:"bg-secondary border-border text-xl font-bold max-w-xs",autoFocus:!0}),e.jsx(_,{size:"icon",variant:"ghost",onClick:f,disabled:o.isPending,children:e.jsx(He,{className:"w-4 h-4 text-green-500"})}),e.jsx(_,{size:"icon",variant:"ghost",onClick:j,children:e.jsx(qe,{className:"w-4 h-4 text-destructive"})})]}):e.jsxs(e.Fragment,{children:[t&&a.length>1?e.jsxs(q,{value:s.id,onValueChange:P,children:[e.jsx(B,{className:"w-auto min-w-[200px] text-2xl font-bold text-primary border-none bg-transparent h-auto py-0 px-0 focus:ring-0",children:e.jsx(H,{})}),e.jsx(W,{children:a.map(w=>e.jsxs(G,{value:w.id,children:[w.name," ",w.is_current&&"(Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹)"]},w.id))})]}):e.jsx("h2",{className:"text-2xl font-bold text-primary",children:s.name}),t&&e.jsx(_,{size:"icon",variant:"ghost",onClick:x,children:e.jsx(We,{className:"w-4 h-4"})})]}),t&&!c&&e.jsxs(_,{variant:"outline",size:"sm",onClick:N,disabled:n.isPending,className:"ml-auto",children:[e.jsx(Me,{className:"w-4 h-4 mr-1"}),"ÐÐ¾Ð²Ñ‹Ð¹ ÑÐµÐ·Ð¾Ð½"]})]}):e.jsxs("div",{className:"flex items-center justify-center gap-4 py-4 bg-secondary/30 rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground",children:"Ð¡ÐµÐ·Ð¾Ð½ Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð½"}),t&&e.jsxs(_,{onClick:N,disabled:n.isPending,children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐµÐ·Ð¾Ð½"]})]})}function kr({selectedTourId:t,onTourChange:a}){const{isAdmin:s}=ie(),{data:r}=Se(),{data:n=[]}=Qe((r==null?void 0:r.id)??null),o=xr(),i=()=>{r&&o.mutate(r.id,{onSuccess:c=>{a(c.id)}})};return r?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{value:t??"",onValueChange:c=>a(c||null),children:[e.jsx(B,{className:"w-[180px] bg-secondary border-border",children:e.jsx(H,{placeholder:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚ÑƒÑ€"})}),e.jsx(W,{children:n.map(c=>e.jsxs(G,{value:c.id,children:["Ð¢ÑƒÑ€ ",c.number]},c.id))})]}),s&&e.jsxs(_,{size:"sm",onClick:i,disabled:o.isPending,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(Me,{className:"w-4 h-4 mr-1"}),"ÐÐ¾Ð²Ñ‹Ð¹ Ñ‚ÑƒÑ€"]})]}):null}function Ar(){const t=oe();return le({mutationFn:async({tourId:a,playerId:s})=>{const{error:r}=await k.from("tours").update({mvp_player_id:s}).eq("id",a);if(r)throw r},onSuccess:()=>{t.invalidateQueries({queryKey:["tours"]}),M.success("MVP Ñ‚ÑƒÑ€Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»Ñ‘Ð½")},onError:a=>{M.error(a.message)}})}function Or({tourId:t,mvpPlayerId:a,tourNumber:s}){const{isAdmin:r}=ie(),{data:n=[]}=Fe(),{data:o=[]}=Pe(),i=Ar(),[c,u]=l.useState(!1),[p,m]=l.useState(""),x=a?n.find(C=>C.id===a):null,f=x?o.find(C=>C.id===x.team_id):null,j=C=>{switch(C){case"red":return"text-team-red";case"blue":return"text-team-blue";case"green":return"text-team-green";case"black":return"text-foreground";default:return"text-muted-foreground"}},N=()=>{m(a||"none"),u(!0)},P=()=>{t&&i.mutate({tourId:t,playerId:p==="none"?null:p||null}),u(!1)},w=()=>{m(a||""),u(!1)};return t?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 px-6 mvp-card rounded-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(es,{className:"w-7 h-7 text-accent trophy-glow"}),e.jsxs("span",{className:"text-xl font-display font-bold text-foreground tracking-wide",children:["MVP Ð¢ÑƒÑ€Ð° ",s]}),r&&!c&&e.jsx(_,{size:"icon",variant:"ghost",onClick:N,className:"h-7 w-7",children:e.jsx(We,{className:"w-4 h-4"})}),c&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{size:"icon",variant:"ghost",onClick:P,disabled:i.isPending,className:"h-7 w-7",children:e.jsx(He,{className:"w-4 h-4 text-green-500"})}),e.jsx(_,{size:"icon",variant:"ghost",onClick:w,className:"h-7 w-7",children:e.jsx(qe,{className:"w-4 h-4 text-destructive"})})]})]}),c?e.jsxs(q,{value:p,onValueChange:m,children:[e.jsx(B,{className:"w-[250px]",children:e.jsx(H,{placeholder:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ MVP"})}),e.jsxs(W,{children:[e.jsx(G,{value:"none",children:"ÐÐµ Ð²Ñ‹Ð±Ñ€Ð°Ð½"}),n.map(C=>{const F=o.find(T=>T.id===C.team_id);return e.jsx(G,{value:C.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(rt,{className:"h-6 w-6",children:[e.jsx(nt,{src:C.photo_url,alt:C.name}),e.jsx(ot,{className:"text-xs",children:C.name[0]})]}),e.jsx("span",{children:C.name}),F&&e.jsxs("span",{className:`text-xs ${j(F.color)}`,children:["(",F.name,")"]})]})},C.id)})]})]}):x?e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(rt,{className:"h-28 w-28 border-4 border-accent/60 shadow-xl",children:[e.jsx(nt,{src:x.photo_url,alt:x.name}),e.jsx(ot,{className:"text-3xl bg-accent/20 font-display",children:x.name[0]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-display font-bold text-foreground tracking-wide",children:x.name}),f&&e.jsx("p",{className:`text-sm font-medium ${j(f.color)}`,children:f.name})]})]}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"MVP Ð½Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½"})]}):null}var lt=["Enter"," "],Fr=["ArrowDown","PageUp","Home"],as=["ArrowUp","PageDown","End"],$r=[...Fr,...as],Lr={ltr:[...lt,"ArrowRight"],rtl:[...lt,"ArrowLeft"]},zr={ltr:["ArrowLeft"],rtl:["ArrowRight"]},$e="Menu",[Ae,Gr,Ur]=Ga($e),[we,rs]=ct($e,[Ur,Gt,Wt]),Ye=Gt(),ns=Wt(),[Kr,_e]=we($e),[Vr,Le]=we($e),os=t=>{const{__scopeMenu:a,open:s=!1,children:r,dir:n,onOpenChange:o,modal:i=!0}=t,c=Ye(a),[u,p]=l.useState(null),m=l.useRef(!1),x=Kt(o),f=wr(n);return l.useEffect(()=>{const j=()=>{m.current=!0,document.addEventListener("pointerdown",N,{capture:!0,once:!0}),document.addEventListener("pointermove",N,{capture:!0,once:!0})},N=()=>m.current=!1;return document.addEventListener("keydown",j,{capture:!0}),()=>{document.removeEventListener("keydown",j,{capture:!0}),document.removeEventListener("pointerdown",N,{capture:!0}),document.removeEventListener("pointermove",N,{capture:!0})}},[]),e.jsx(Ba,{...c,children:e.jsx(Kr,{scope:a,open:s,onOpenChange:x,content:u,onContentChange:p,children:e.jsx(Vr,{scope:a,onClose:l.useCallback(()=>x(!1),[x]),isUsingKeyboardRef:m,dir:f,modal:i,children:r})})})};os.displayName=$e;var qr="MenuAnchor",pt=l.forwardRef((t,a)=>{const{__scopeMenu:s,...r}=t,n=Ye(s);return e.jsx(Ua,{...n,...r,ref:a})});pt.displayName=qr;var ft="MenuPortal",[Br,ls]=we(ft,{forceMount:void 0}),cs=t=>{const{__scopeMenu:a,forceMount:s,children:r,container:n}=t,o=_e(ft,a);return e.jsx(Br,{scope:a,forceMount:s,children:e.jsx(be,{present:s||o.open,children:e.jsx(qt,{asChild:!0,container:n,children:r})})})};cs.displayName=ft;var J="MenuContent",[Hr,ht]=we(J),is=l.forwardRef((t,a)=>{const s=ls(J,t.__scopeMenu),{forceMount:r=s.forceMount,...n}=t,o=_e(J,t.__scopeMenu),i=Le(J,t.__scopeMenu);return e.jsx(Ae.Provider,{scope:t.__scopeMenu,children:e.jsx(be,{present:r||o.open,children:e.jsx(Ae.Slot,{scope:t.__scopeMenu,children:i.modal?e.jsx(Wr,{...n,ref:a}):e.jsx(Qr,{...n,ref:a})})})})}),Wr=l.forwardRef((t,a)=>{const s=_e(J,t.__scopeMenu),r=l.useRef(null),n=ye(a,r);return l.useEffect(()=>{const o=r.current;if(o)return Qt(o)},[]),e.jsx(gt,{...t,ref:n,trapFocus:s.open,disableOutsidePointerEvents:s.open,disableOutsideScroll:!0,onFocusOutside:S(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>s.onOpenChange(!1)})}),Qr=l.forwardRef((t,a)=>{const s=_e(J,t.__scopeMenu);return e.jsx(gt,{...t,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>s.onOpenChange(!1)})}),Yr=Bt("MenuContent.ScrollLock"),gt=l.forwardRef((t,a)=>{const{__scopeMenu:s,loop:r=!1,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:c,onEntryFocus:u,onEscapeKeyDown:p,onPointerDownOutside:m,onFocusOutside:x,onInteractOutside:f,onDismiss:j,disableOutsideScroll:N,...P}=t,w=_e(J,s),C=Le(J,s),F=Ye(s),T=ns(s),K=Gr(s),[de,ce]=l.useState(null),ee=l.useRef(null),V=ye(a,ee,w.onContentChange),g=l.useRef(0),b=l.useRef(""),y=l.useRef(0),D=l.useRef(null),E=l.useRef("right"),$=l.useRef(0),z=N?Zt:l.Fragment,O=N?{as:Yr,allowPinchZoom:!0}:void 0,h=v=>{var se,Te;const I=b.current+v,X=K().filter(Y=>!Y.disabled),te=document.activeElement,ue=(se=X.find(Y=>Y.ref.current===te))==null?void 0:se.textValue,Ce=X.map(Y=>Y.textValue),je=cn(Ce,I,ue),me=(Te=X.find(Y=>Y.textValue===je))==null?void 0:Te.ref.current;(function Y(De){b.current=De,window.clearTimeout(g.current),De!==""&&(g.current=window.setTimeout(()=>Y(""),1e3))})(I),me&&setTimeout(()=>me.focus())};l.useEffect(()=>()=>window.clearTimeout(g.current),[]),Yt();const A=l.useCallback(v=>{var X,te;return E.current===((X=D.current)==null?void 0:X.side)&&un(v,(te=D.current)==null?void 0:te.area)},[]);return e.jsx(Hr,{scope:s,searchRef:b,onItemEnter:l.useCallback(v=>{A(v)&&v.preventDefault()},[A]),onItemLeave:l.useCallback(v=>{var I;A(v)||((I=ee.current)==null||I.focus(),ce(null))},[A]),onTriggerLeave:l.useCallback(v=>{A(v)&&v.preventDefault()},[A]),pointerGraceTimerRef:y,onPointerGraceIntentChange:l.useCallback(v=>{D.current=v},[]),children:e.jsx(z,{...O,children:e.jsx(Xt,{asChild:!0,trapped:n,onMountAutoFocus:S(o,v=>{var I;v.preventDefault(),(I=ee.current)==null||I.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:e.jsx(Ut,{asChild:!0,disableOutsidePointerEvents:c,onEscapeKeyDown:p,onPointerDownOutside:m,onFocusOutside:x,onInteractOutside:f,onDismiss:j,children:e.jsx(cr,{asChild:!0,...T,dir:C.dir,orientation:"vertical",loop:r,currentTabStopId:de,onCurrentTabStopIdChange:ce,onEntryFocus:S(u,v=>{C.isUsingKeyboardRef.current||v.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Ka,{role:"menu","aria-orientation":"vertical","data-state":Cs(w.open),"data-radix-menu-content":"",dir:C.dir,...F,...P,ref:V,style:{outline:"none",...P.style},onKeyDown:S(P.onKeyDown,v=>{const X=v.target.closest("[data-radix-menu-content]")===v.currentTarget,te=v.ctrlKey||v.altKey||v.metaKey,ue=v.key.length===1;X&&(v.key==="Tab"&&v.preventDefault(),!te&&ue&&h(v.key));const Ce=ee.current;if(v.target!==Ce||!$r.includes(v.key))return;v.preventDefault();const me=K().filter(se=>!se.disabled).map(se=>se.ref.current);as.includes(v.key)&&me.reverse(),on(me)}),onBlur:S(t.onBlur,v=>{v.currentTarget.contains(v.target)||(window.clearTimeout(g.current),b.current="")}),onPointerMove:S(t.onPointerMove,Oe(v=>{const I=v.target,X=$.current!==v.clientX;if(v.currentTarget.contains(I)&&X){const te=v.clientX>$.current?"right":"left";E.current=te,$.current=v.clientX}}))})})})})})})});is.displayName=J;var Xr="MenuGroup",yt=l.forwardRef((t,a)=>{const{__scopeMenu:s,...r}=t;return e.jsx(ae.div,{role:"group",...r,ref:a})});yt.displayName=Xr;var Zr="MenuLabel",ds=l.forwardRef((t,a)=>{const{__scopeMenu:s,...r}=t;return e.jsx(ae.div,{...r,ref:a})});ds.displayName=Zr;var Ue="MenuItem",$t="menu.itemSelect",Xe=l.forwardRef((t,a)=>{const{disabled:s=!1,onSelect:r,...n}=t,o=l.useRef(null),i=Le(Ue,t.__scopeMenu),c=ht(Ue,t.__scopeMenu),u=ye(a,o),p=l.useRef(!1),m=()=>{const x=o.current;if(!s&&x){const f=new CustomEvent($t,{bubbles:!0,cancelable:!0});x.addEventListener($t,j=>r==null?void 0:r(j),{once:!0}),qa(x,f),f.defaultPrevented?p.current=!1:i.onClose()}};return e.jsx(us,{...n,ref:u,disabled:s,onClick:S(t.onClick,m),onPointerDown:x=>{var f;(f=t.onPointerDown)==null||f.call(t,x),p.current=!0},onPointerUp:S(t.onPointerUp,x=>{var f;p.current||(f=x.currentTarget)==null||f.click()}),onKeyDown:S(t.onKeyDown,x=>{const f=c.searchRef.current!=="";s||f&&x.key===" "||lt.includes(x.key)&&(x.currentTarget.click(),x.preventDefault())})})});Xe.displayName=Ue;var us=l.forwardRef((t,a)=>{const{__scopeMenu:s,disabled:r=!1,textValue:n,...o}=t,i=ht(Ue,s),c=ns(s),u=l.useRef(null),p=ye(a,u),[m,x]=l.useState(!1),[f,j]=l.useState("");return l.useEffect(()=>{const N=u.current;N&&j((N.textContent??"").trim())},[o.children]),e.jsx(Ae.ItemSlot,{scope:s,disabled:r,textValue:n??f,children:e.jsx(ir,{asChild:!0,...c,focusable:!r,children:e.jsx(ae.div,{role:"menuitem","data-highlighted":m?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...o,ref:p,onPointerMove:S(t.onPointerMove,Oe(N=>{r?i.onItemLeave(N):(i.onItemEnter(N),N.defaultPrevented||N.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:S(t.onPointerLeave,Oe(N=>i.onItemLeave(N))),onFocus:S(t.onFocus,()=>x(!0)),onBlur:S(t.onBlur,()=>x(!1))})})})}),Jr="MenuCheckboxItem",ms=l.forwardRef((t,a)=>{const{checked:s=!1,onCheckedChange:r,...n}=t;return e.jsx(gs,{scope:t.__scopeMenu,checked:s,children:e.jsx(Xe,{role:"menuitemcheckbox","aria-checked":Ke(s)?"mixed":s,...n,ref:a,"data-state":Nt(s),onSelect:S(n.onSelect,()=>r==null?void 0:r(Ke(s)?!0:!s),{checkForDefaultPrevented:!1})})})});ms.displayName=Jr;var xs="MenuRadioGroup",[en,tn]=we(xs,{value:void 0,onValueChange:()=>{}}),ps=l.forwardRef((t,a)=>{const{value:s,onValueChange:r,...n}=t,o=Kt(r);return e.jsx(en,{scope:t.__scopeMenu,value:s,onValueChange:o,children:e.jsx(yt,{...n,ref:a})})});ps.displayName=xs;var fs="MenuRadioItem",hs=l.forwardRef((t,a)=>{const{value:s,...r}=t,n=tn(fs,t.__scopeMenu),o=s===n.value;return e.jsx(gs,{scope:t.__scopeMenu,checked:o,children:e.jsx(Xe,{role:"menuitemradio","aria-checked":o,...r,ref:a,"data-state":Nt(o),onSelect:S(r.onSelect,()=>{var i;return(i=n.onValueChange)==null?void 0:i.call(n,s)},{checkForDefaultPrevented:!1})})})});hs.displayName=fs;var jt="MenuItemIndicator",[gs,sn]=we(jt,{checked:!1}),ys=l.forwardRef((t,a)=>{const{__scopeMenu:s,forceMount:r,...n}=t,o=sn(jt,s);return e.jsx(be,{present:r||Ke(o.checked)||o.checked===!0,children:e.jsx(ae.span,{...n,ref:a,"data-state":Nt(o.checked)})})});ys.displayName=jt;var an="MenuSeparator",js=l.forwardRef((t,a)=>{const{__scopeMenu:s,...r}=t;return e.jsx(ae.div,{role:"separator","aria-orientation":"horizontal",...r,ref:a})});js.displayName=an;var rn="MenuArrow",Ns=l.forwardRef((t,a)=>{const{__scopeMenu:s,...r}=t,n=Ye(s);return e.jsx(Va,{...n,...r,ref:a})});Ns.displayName=rn;var nn="MenuSub",[vl,vs]=we(nn),Re="MenuSubTrigger",bs=l.forwardRef((t,a)=>{const s=_e(Re,t.__scopeMenu),r=Le(Re,t.__scopeMenu),n=vs(Re,t.__scopeMenu),o=ht(Re,t.__scopeMenu),i=l.useRef(null),{pointerGraceTimerRef:c,onPointerGraceIntentChange:u}=o,p={__scopeMenu:t.__scopeMenu},m=l.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return l.useEffect(()=>m,[m]),l.useEffect(()=>{const x=c.current;return()=>{window.clearTimeout(x),u(null)}},[c,u]),e.jsx(pt,{asChild:!0,...p,children:e.jsx(us,{id:n.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":n.contentId,"data-state":Cs(s.open),...t,ref:Vt(a,n.onTriggerChange),onClick:x=>{var f;(f=t.onClick)==null||f.call(t,x),!(t.disabled||x.defaultPrevented)&&(x.currentTarget.focus(),s.open||s.onOpenChange(!0))},onPointerMove:S(t.onPointerMove,Oe(x=>{o.onItemEnter(x),!x.defaultPrevented&&!t.disabled&&!s.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{s.onOpenChange(!0),m()},100))})),onPointerLeave:S(t.onPointerLeave,Oe(x=>{var j,N;m();const f=(j=s.content)==null?void 0:j.getBoundingClientRect();if(f){const P=(N=s.content)==null?void 0:N.dataset.side,w=P==="right",C=w?-5:5,F=f[w?"left":"right"],T=f[w?"right":"left"];o.onPointerGraceIntentChange({area:[{x:x.clientX+C,y:x.clientY},{x:F,y:f.top},{x:T,y:f.top},{x:T,y:f.bottom},{x:F,y:f.bottom}],side:P}),window.clearTimeout(c.current),c.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(x),x.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:S(t.onKeyDown,x=>{var j;const f=o.searchRef.current!=="";t.disabled||f&&x.key===" "||Lr[r.dir].includes(x.key)&&(s.onOpenChange(!0),(j=s.content)==null||j.focus(),x.preventDefault())})})})});bs.displayName=Re;var ws="MenuSubContent",_s=l.forwardRef((t,a)=>{const s=ls(J,t.__scopeMenu),{forceMount:r=s.forceMount,...n}=t,o=_e(J,t.__scopeMenu),i=Le(J,t.__scopeMenu),c=vs(ws,t.__scopeMenu),u=l.useRef(null),p=ye(a,u);return e.jsx(Ae.Provider,{scope:t.__scopeMenu,children:e.jsx(be,{present:r||o.open,children:e.jsx(Ae.Slot,{scope:t.__scopeMenu,children:e.jsx(gt,{id:c.contentId,"aria-labelledby":c.triggerId,...n,ref:p,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:m=>{var x;i.isUsingKeyboardRef.current&&((x=u.current)==null||x.focus()),m.preventDefault()},onCloseAutoFocus:m=>m.preventDefault(),onFocusOutside:S(t.onFocusOutside,m=>{m.target!==c.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:S(t.onEscapeKeyDown,m=>{i.onClose(),m.preventDefault()}),onKeyDown:S(t.onKeyDown,m=>{var j;const x=m.currentTarget.contains(m.target),f=zr[i.dir].includes(m.key);x&&f&&(o.onOpenChange(!1),(j=c.trigger)==null||j.focus(),m.preventDefault())})})})})})});_s.displayName=ws;function Cs(t){return t?"open":"closed"}function Ke(t){return t==="indeterminate"}function Nt(t){return Ke(t)?"indeterminate":t?"checked":"unchecked"}function on(t){const a=document.activeElement;for(const s of t)if(s===a||(s.focus(),document.activeElement!==a))return}function ln(t,a){return t.map((s,r)=>t[(a+r)%t.length])}function cn(t,a,s){const n=a.length>1&&Array.from(a).every(p=>p===a[0])?a[0]:a,o=s?t.indexOf(s):-1;let i=ln(t,Math.max(o,0));n.length===1&&(i=i.filter(p=>p!==s));const u=i.find(p=>p.toLowerCase().startsWith(n.toLowerCase()));return u!==s?u:void 0}function dn(t,a){const{x:s,y:r}=t;let n=!1;for(let o=0,i=a.length-1;o<a.length;i=o++){const c=a[o],u=a[i],p=c.x,m=c.y,x=u.x,f=u.y;m>r!=f>r&&s<(x-p)*(r-m)/(f-m)+p&&(n=!n)}return n}function un(t,a){if(!a)return!1;const s={x:t.clientX,y:t.clientY};return dn(s,a)}function Oe(t){return a=>a.pointerType==="mouse"?t(a):void 0}var mn=os,xn=pt,pn=cs,fn=is,hn=yt,gn=ds,yn=Xe,jn=ms,Nn=ps,vn=hs,bn=ys,wn=js,_n=Ns,Cn=bs,Mn=_s,Ze="DropdownMenu",[Sn,bl]=ct(Ze,[rs]),Q=rs(),[Pn,Ms]=Sn(Ze),Ss=t=>{const{__scopeDropdownMenu:a,children:s,dir:r,open:n,defaultOpen:o,onOpenChange:i,modal:c=!0}=t,u=Q(a),p=l.useRef(null),[m,x]=Ht({prop:n,defaultProp:o??!1,onChange:i,caller:Ze});return e.jsx(Pn,{scope:a,triggerId:ke(),triggerRef:p,contentId:ke(),open:m,onOpenChange:x,onOpenToggle:l.useCallback(()=>x(f=>!f),[x]),modal:c,children:e.jsx(mn,{...u,open:m,onOpenChange:x,dir:r,modal:c,children:s})})};Ss.displayName=Ze;var Ps="DropdownMenuTrigger",Ts=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,disabled:r=!1,...n}=t,o=Ms(Ps,s),i=Q(s);return e.jsx(xn,{asChild:!0,...i,children:e.jsx(ae.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...n,ref:Vt(a,o.triggerRef),onPointerDown:S(t.onPointerDown,c=>{!r&&c.button===0&&c.ctrlKey===!1&&(o.onOpenToggle(),o.open||c.preventDefault())}),onKeyDown:S(t.onKeyDown,c=>{r||(["Enter"," "].includes(c.key)&&o.onOpenToggle(),c.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(c.key)&&c.preventDefault())})})})});Ts.displayName=Ps;var Tn="DropdownMenuPortal",Ds=t=>{const{__scopeDropdownMenu:a,...s}=t,r=Q(a);return e.jsx(pn,{...r,...s})};Ds.displayName=Tn;var Es="DropdownMenuContent",Is=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Ms(Es,s),o=Q(s),i=l.useRef(!1);return e.jsx(fn,{id:n.contentId,"aria-labelledby":n.triggerId,...o,...r,ref:a,onCloseAutoFocus:S(t.onCloseAutoFocus,c=>{var u;i.current||(u=n.triggerRef.current)==null||u.focus(),i.current=!1,c.preventDefault()}),onInteractOutside:S(t.onInteractOutside,c=>{const u=c.detail.originalEvent,p=u.button===0&&u.ctrlKey===!0,m=u.button===2||p;(!n.modal||m)&&(i.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Is.displayName=Es;var Dn="DropdownMenuGroup",En=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(hn,{...n,...r,ref:a})});En.displayName=Dn;var In="DropdownMenuLabel",Rs=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(gn,{...n,...r,ref:a})});Rs.displayName=In;var Rn="DropdownMenuItem",ks=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(yn,{...n,...r,ref:a})});ks.displayName=Rn;var kn="DropdownMenuCheckboxItem",As=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(jn,{...n,...r,ref:a})});As.displayName=kn;var An="DropdownMenuRadioGroup",On=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(Nn,{...n,...r,ref:a})});On.displayName=An;var Fn="DropdownMenuRadioItem",Os=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(vn,{...n,...r,ref:a})});Os.displayName=Fn;var $n="DropdownMenuItemIndicator",Fs=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(bn,{...n,...r,ref:a})});Fs.displayName=$n;var Ln="DropdownMenuSeparator",$s=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(wn,{...n,...r,ref:a})});$s.displayName=Ln;var zn="DropdownMenuArrow",Gn=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(_n,{...n,...r,ref:a})});Gn.displayName=zn;var Un="DropdownMenuSubTrigger",Ls=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(Cn,{...n,...r,ref:a})});Ls.displayName=Un;var Kn="DropdownMenuSubContent",zs=l.forwardRef((t,a)=>{const{__scopeDropdownMenu:s,...r}=t,n=Q(s);return e.jsx(Mn,{...n,...r,ref:a,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});zs.displayName=Kn;var Vn=Ss,qn=Ts,Bn=Ds,Gs=Is,Us=Rs,Ks=ks,Vs=As,qs=Os,Bs=Fs,Hs=$s,Ws=Ls,Qs=zs;const Hn=Vn,Wn=qn,Qn=l.forwardRef(({className:t,inset:a,children:s,...r},n)=>e.jsxs(Ws,{ref:n,className:Z("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",a&&"pl-8",t),...r,children:[s,e.jsx(Tr,{className:"ml-auto h-4 w-4"})]}));Qn.displayName=Ws.displayName;const Yn=l.forwardRef(({className:t,...a},s)=>e.jsx(Qs,{ref:s,className:Z("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a}));Yn.displayName=Qs.displayName;const Ys=l.forwardRef(({className:t,sideOffset:a=4,...s},r)=>e.jsx(Bn,{children:e.jsx(Gs,{ref:r,sideOffset:a,className:Z("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s})}));Ys.displayName=Gs.displayName;const Xs=l.forwardRef(({className:t,inset:a,...s},r)=>e.jsx(Ks,{ref:r,className:Z("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",a&&"pl-8",t),...s}));Xs.displayName=Ks.displayName;const Xn=l.forwardRef(({className:t,children:a,checked:s,...r},n)=>e.jsxs(Vs,{ref:n,className:Z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),checked:s,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Bs,{children:e.jsx(He,{className:"h-4 w-4"})})}),a]}));Xn.displayName=Vs.displayName;const Zn=l.forwardRef(({className:t,children:a,...s},r)=>e.jsxs(qs,{ref:r,className:Z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Bs,{children:e.jsx(Dr,{className:"h-2 w-2 fill-current"})})}),a]}));Zn.displayName=qs.displayName;const Jn=l.forwardRef(({className:t,inset:a,...s},r)=>e.jsx(Us,{ref:r,className:Z("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",t),...s}));Jn.displayName=Us.displayName;const eo=l.forwardRef(({className:t,...a},s)=>e.jsx(Hs,{ref:s,className:Z("-mx-1 my-1 h-px bg-muted",t),...a}));eo.displayName=Hs.displayName;function to(t,a,s,r,n){let o=0,i=0,c=0,u=0,p=0;return n.forEach(m=>{m.home_team_id===t?(u+=m.home_score,p+=m.away_score,m.home_score>m.away_score?o++:m.home_score===m.away_score?i++:c++):m.away_team_id===t&&(u+=m.away_score,p+=m.home_score,m.away_score>m.home_score?o++:m.away_score===m.home_score?i++:c++)}),{teamId:t,teamName:a,color:s,tourTeamId:r,played:o+i+c,won:o,drawn:i,lost:c,goalsFor:u,goalsAgainst:p,goalDiff:u-p,points:o*3+i}}const so=[{value:"red",label:"ÐšÑ€Ð°ÑÐ½Ñ‹Ð¹",className:"bg-team-red"},{value:"blue",label:"Ð¡Ð¸Ð½Ð¸Ð¹",className:"bg-team-blue"},{value:"green",label:"Ð—ÐµÐ»Ñ‘Ð½Ñ‹Ð¹",className:"bg-team-green"},{value:"black",label:"Ð§Ñ‘Ñ€Ð½Ñ‹Ð¹",className:"bg-team-black"}];function ao({tourId:t}){const{isAdmin:a}=ie(),{data:s=[]}=ts(t),{data:r=[]}=Pe(),{data:n=[]}=mt(t),o=Ja(),i=l.useMemo(()=>s.map(u=>{const p=r.find(x=>x.id===u.team_id),m=(p==null?void 0:p.color)??"black";return to(u.team_id,u.team.name,m,u.id,n)}).sort((u,p)=>p.points-u.points||p.goalDiff-u.goalDiff),[s,n,r]),c=u=>{switch(u){case"red":return"bg-team-red px-2 py-0.5 rounded";case"blue":return"bg-team-blue px-2 py-0.5 rounded";case"green":return"bg-team-green px-2 py-0.5 rounded";case"black":return"bg-team-black text-foreground px-2 py-0.5 rounded";default:return""}};return t?e.jsxs("div",{className:"stat-card",children:[e.jsx("h2",{className:"text-xl font-display font-bold text-foreground tracking-wide mb-4",children:"Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ñ‚ÑƒÑ€Ð°"}),i.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð² Ñ‚ÑƒÑ€"}):e.jsx("div",{className:"overflow-x-auto football-table",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border text-muted-foreground",children:[e.jsx("th",{className:"text-left py-3 px-3 font-display tracking-wide",children:"ÐšÐ¾Ð¼Ð°Ð½Ð´Ð°"}),e.jsx("th",{className:"text-center py-3 px-1 font-display",children:"Ð˜"}),e.jsx("th",{className:"text-center py-3 px-1 font-display",children:"Ð’"}),e.jsx("th",{className:"text-center py-3 px-1 font-display",children:"Ð"}),e.jsx("th",{className:"text-center py-3 px-1 font-display",children:"ÐŸ"}),e.jsx("th",{className:"text-center py-3 px-1 font-display",children:"Ð“Ð—"}),e.jsx("th",{className:"text-center py-3 px-1 font-display",children:"Ð“ÐŸ"}),e.jsx("th",{className:"text-center py-3 px-1 font-display",children:"Ð Ð°Ð·Ð½"}),e.jsx("th",{className:"text-center py-3 px-1 font-display text-primary",children:"ÐžÑ‡ÐºÐ¸"}),a&&e.jsx("th",{className:"w-8"})]})}),e.jsx("tbody",{children:i.map(u=>e.jsxs("tr",{className:"border-b border-border/50 transition-colors",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:e.jsx("span",{className:c(u.color),children:u.teamName})}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:u.played}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:u.won}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:u.drawn}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:u.lost}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:u.goalsFor}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:u.goalsAgainst}),e.jsxs("td",{className:"text-center py-2 px-1 font-mono",children:[u.goalDiff>0?"+":"",u.goalDiff]}),e.jsx("td",{className:"text-center py-2 px-1 font-mono font-bold text-primary",children:u.points}),a&&e.jsx("td",{className:"py-2 px-1",children:e.jsxs(Hn,{children:[e.jsx(Wn,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"icon",className:"h-6 w-6",children:e.jsx(Er,{className:"w-3 h-3"})})}),e.jsx(Ys,{children:so.map(p=>e.jsxs(Xs,{onClick:()=>o.mutate({id:u.teamId,color:p.value}),className:"gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded ${p.className}`}),p.label]},p.value))})]})})]},u.teamId))})]})})]}):e.jsxs("div",{className:"stat-card",children:[e.jsx("h2",{className:"text-xl font-display font-bold text-foreground tracking-wide mb-4",children:"Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ñ‚ÑƒÑ€Ð°"}),e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¸Ð»Ð¸ Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚ÑƒÑ€"})]})}var Je="Dialog",[Zs,wl]=ct(Je),[ro,re]=Zs(Je),Js=t=>{const{__scopeDialog:a,children:s,open:r,defaultOpen:n,onOpenChange:o,modal:i=!0}=t,c=l.useRef(null),u=l.useRef(null),[p,m]=Ht({prop:r,defaultProp:n??!1,onChange:o,caller:Je});return e.jsx(ro,{scope:a,triggerRef:c,contentRef:u,contentId:ke(),titleId:ke(),descriptionId:ke(),open:p,onOpenChange:m,onOpenToggle:l.useCallback(()=>m(x=>!x),[m]),modal:i,children:s})};Js.displayName=Je;var ea="DialogTrigger",no=l.forwardRef((t,a)=>{const{__scopeDialog:s,...r}=t,n=re(ea,s),o=ye(a,n.triggerRef);return e.jsx(ae.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":wt(n.open),...r,ref:o,onClick:S(t.onClick,n.onOpenToggle)})});no.displayName=ea;var vt="DialogPortal",[oo,ta]=Zs(vt,{forceMount:void 0}),sa=t=>{const{__scopeDialog:a,forceMount:s,children:r,container:n}=t,o=re(vt,a);return e.jsx(oo,{scope:a,forceMount:s,children:l.Children.map(r,i=>e.jsx(be,{present:s||o.open,children:e.jsx(qt,{asChild:!0,container:n,children:i})}))})};sa.displayName=vt;var Ve="DialogOverlay",aa=l.forwardRef((t,a)=>{const s=ta(Ve,t.__scopeDialog),{forceMount:r=s.forceMount,...n}=t,o=re(Ve,t.__scopeDialog);return o.modal?e.jsx(be,{present:r||o.open,children:e.jsx(co,{...n,ref:a})}):null});aa.displayName=Ve;var lo=Bt("DialogOverlay.RemoveScroll"),co=l.forwardRef((t,a)=>{const{__scopeDialog:s,...r}=t,n=re(Ve,s);return e.jsx(Zt,{as:lo,allowPinchZoom:!0,shards:[n.contentRef],children:e.jsx(ae.div,{"data-state":wt(n.open),...r,ref:a,style:{pointerEvents:"auto",...r.style}})})}),ve="DialogContent",ra=l.forwardRef((t,a)=>{const s=ta(ve,t.__scopeDialog),{forceMount:r=s.forceMount,...n}=t,o=re(ve,t.__scopeDialog);return e.jsx(be,{present:r||o.open,children:o.modal?e.jsx(io,{...n,ref:a}):e.jsx(uo,{...n,ref:a})})});ra.displayName=ve;var io=l.forwardRef((t,a)=>{const s=re(ve,t.__scopeDialog),r=l.useRef(null),n=ye(a,s.contentRef,r);return l.useEffect(()=>{const o=r.current;if(o)return Qt(o)},[]),e.jsx(na,{...t,ref:n,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:S(t.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=s.triggerRef.current)==null||i.focus()}),onPointerDownOutside:S(t.onPointerDownOutside,o=>{const i=o.detail.originalEvent,c=i.button===0&&i.ctrlKey===!0;(i.button===2||c)&&o.preventDefault()}),onFocusOutside:S(t.onFocusOutside,o=>o.preventDefault())})}),uo=l.forwardRef((t,a)=>{const s=re(ve,t.__scopeDialog),r=l.useRef(!1),n=l.useRef(!1);return e.jsx(na,{...t,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,c;(i=t.onCloseAutoFocus)==null||i.call(t,o),o.defaultPrevented||(r.current||(c=s.triggerRef.current)==null||c.focus(),o.preventDefault()),r.current=!1,n.current=!1},onInteractOutside:o=>{var u,p;(u=t.onInteractOutside)==null||u.call(t,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const i=o.target;((p=s.triggerRef.current)==null?void 0:p.contains(i))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&n.current&&o.preventDefault()}})}),na=l.forwardRef((t,a)=>{const{__scopeDialog:s,trapFocus:r,onOpenAutoFocus:n,onCloseAutoFocus:o,...i}=t,c=re(ve,s),u=l.useRef(null),p=ye(a,u);return Yt(),e.jsxs(e.Fragment,{children:[e.jsx(Xt,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:n,onUnmountAutoFocus:o,children:e.jsx(Ut,{role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":wt(c.open),...i,ref:p,onDismiss:()=>c.onOpenChange(!1)})}),e.jsxs(e.Fragment,{children:[e.jsx(mo,{titleId:c.titleId}),e.jsx(po,{contentRef:u,descriptionId:c.descriptionId})]})]})}),bt="DialogTitle",oa=l.forwardRef((t,a)=>{const{__scopeDialog:s,...r}=t,n=re(bt,s);return e.jsx(ae.h2,{id:n.titleId,...r,ref:a})});oa.displayName=bt;var la="DialogDescription",ca=l.forwardRef((t,a)=>{const{__scopeDialog:s,...r}=t,n=re(la,s);return e.jsx(ae.p,{id:n.descriptionId,...r,ref:a})});ca.displayName=la;var ia="DialogClose",da=l.forwardRef((t,a)=>{const{__scopeDialog:s,...r}=t,n=re(ia,s);return e.jsx(ae.button,{type:"button",...r,ref:a,onClick:S(t.onClick,()=>n.onOpenChange(!1))})});da.displayName=ia;function wt(t){return t?"open":"closed"}var ua="DialogTitleWarning",[_l,ma]=Ha(ua,{contentName:ve,titleName:bt,docsSlug:"dialog"}),mo=({titleId:t})=>{const a=ma(ua),s=`\`${a.contentName}\` requires a \`${a.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${a.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${a.docsSlug}`;return l.useEffect(()=>{t&&(document.getElementById(t)||console.error(s))},[s,t]),null},xo="DialogDescriptionWarning",po=({contentRef:t,descriptionId:a})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ma(xo).contentName}}.`;return l.useEffect(()=>{var o;const n=(o=t.current)==null?void 0:o.getAttribute("aria-describedby");a&&n&&(document.getElementById(a)||console.warn(r))},[r,t,a]),null},fo=Js,ho=sa,xa=aa,pa=ra,fa=oa,ha=ca,go=da;const yo=fo,jo=ho,ga=l.forwardRef(({className:t,...a},s)=>e.jsx(xa,{ref:s,className:Z("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a}));ga.displayName=xa.displayName;const ya=l.forwardRef(({className:t,children:a,...s},r)=>e.jsxs(jo,{children:[e.jsx(ga,{}),e.jsxs(pa,{ref:r,className:Z("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[a,e.jsxs(go,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ya.displayName=pa.displayName;const ja=({className:t,...a})=>e.jsx("div",{className:Z("flex flex-col space-y-1.5 text-center sm:text-left",t),...a});ja.displayName="DialogHeader";const Na=l.forwardRef(({className:t,...a},s)=>e.jsx(fa,{ref:s,className:Z("text-lg font-semibold leading-none tracking-tight",t),...a}));Na.displayName=fa.displayName;const No=l.forwardRef(({className:t,...a},s)=>e.jsx(ha,{ref:s,className:Z("text-sm text-muted-foreground",t),...a}));No.displayName=ha.displayName;function va(){const t=oe();return le({mutationFn:async a=>{const{data:s,error:r}=await k.from("matches").select("home_team_id, away_team_id, tour_id").eq("id",a).single();if(r)throw r;const{data:n,error:o}=await k.from("player_stats").select("goals, own_goals, player_id, player:players(team_id)").eq("match_id",a);if(o)throw o;const{data:i,error:c}=await k.from("tour_player_substitutions").select("original_player_id, substitute_player_id, original_player:players!tour_player_substitutions_original_player_id_fkey(team_id)").eq("tour_id",s.tour_id);if(c)throw c;const u=new Map;i==null||i.forEach(f=>{var j;(j=f.original_player)!=null&&j.team_id&&u.set(f.substitute_player_id,f.original_player.team_id)});let p=0,m=0;n==null||n.forEach(f=>{var w;const j=f.goals||0,N=f.own_goals||0;let P=(w=f.player)==null?void 0:w.team_id;P||(P=u.get(f.player_id)),P===s.home_team_id?(p+=j,m+=N):P===s.away_team_id&&(m+=j,p+=N)});const{error:x}=await k.from("matches").update({home_score:p,away_score:m}).eq("id",a);if(x)throw x;return{homeScore:p,awayScore:m}},onSuccess:()=>{t.invalidateQueries({queryKey:["matches"]}),t.invalidateQueries({queryKey:["all-matches"]})}})}function vo({match:t,isOpen:a,onClose:s}){const{isAdmin:r}=ie(),{data:n=[],refetch:o}=pr((t==null?void 0:t.id)??null),{data:i=[]}=Fe(),c=Jt(),u=fr(),p=hr(),m=va(),[x,f]=l.useState(null),[j,N]=l.useState({goals:0,own_goals:0,assists:0,yellow_cards:0,red_cards:0}),[P,w]=l.useState(!1),[C,F]=l.useState(""),[T,K]=l.useState({goals:0,own_goals:0,assists:0,yellow_cards:0,red_cards:0});if(!t)return null;const de=[t.home_team_id,t.away_team_id],ce=i.filter(h=>de.includes(h.team_id)),ee=n.map(h=>h.player_id),V=ce.filter(h=>!ee.includes(h.id)),g=n.filter(h=>{var A;return((A=h.player)==null?void 0:A.team_id)===t.home_team_id}),b=n.filter(h=>{var A;return((A=h.player)==null?void 0:A.team_id)===t.away_team_id}),y=h=>{f(h.id),N({goals:h.goals||0,own_goals:h.own_goals||0,assists:h.assists||0,yellow_cards:h.yellow_cards||0,red_cards:h.red_cards||0})},D=async()=>{!x||!t||(await u.mutateAsync({id:x,...j}),await m.mutateAsync(t.id),f(null),o())},E=async h=>{t&&(await p.mutateAsync(h),await m.mutateAsync(t.id),o())},$=async()=>{if(!C||!t){M.error("Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ°");return}await c.mutateAsync({match_id:t.id,player_id:C,goals:T.goals,own_goals:T.own_goals,assists:T.assists,yellow_cards:T.yellow_cards,red_cards:T.red_cards}),await m.mutateAsync(t.id),w(!1),F(""),K({goals:0,own_goals:0,assists:0,yellow_cards:0,red_cards:0}),o()},z=(h,A)=>{const v=h.player;return v?A&&r?e.jsxs("div",{className:"flex items-center gap-2 py-2 px-3 bg-secondary/50 rounded-lg",children:[e.jsx("span",{className:"flex-1 font-medium text-sm",children:v.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"text-[10px] text-muted-foreground",children:"âš½"}),e.jsx(L,{type:"number",min:"0",max:"2",value:j.goals,onChange:I=>N({...j,goals:parseInt(I.target.value)||0}),className:"w-12 h-7 text-xs text-center p-1"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"text-[10px] text-muted-foreground",children:"ðŸ”„"}),e.jsx(L,{type:"number",min:"0",max:"2",value:j.own_goals,onChange:I=>N({...j,own_goals:parseInt(I.target.value)||0}),className:"w-12 h-7 text-xs text-center p-1"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"text-[10px] text-muted-foreground",children:"ðŸ‘Ÿ"}),e.jsx(L,{type:"number",min:"0",value:j.assists,onChange:I=>N({...j,assists:parseInt(I.target.value)||0}),className:"w-12 h-7 text-xs text-center p-1"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"text-[10px] text-muted-foreground",children:"ðŸŸ¨"}),e.jsx(L,{type:"number",min:"0",value:j.yellow_cards,onChange:I=>N({...j,yellow_cards:parseInt(I.target.value)||0}),className:"w-12 h-7 text-xs text-center p-1"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"text-[10px] text-muted-foreground",children:"ðŸŸ¥"}),e.jsx(L,{type:"number",min:"0",value:j.red_cards,onChange:I=>N({...j,red_cards:parseInt(I.target.value)||0}),className:"w-12 h-7 text-xs text-center p-1"})]})]}),e.jsx(_,{size:"sm",variant:"ghost",onClick:D,className:"h-7 w-7 p-0 text-green-500",children:e.jsx(He,{className:"w-4 h-4"})}),e.jsx(_,{size:"sm",variant:"ghost",onClick:()=>f(null),className:"h-7 w-7 p-0 text-muted-foreground",children:e.jsx(qe,{className:"w-4 h-4"})})]},h.id):e.jsxs("div",{className:"flex items-center gap-2 py-2 px-3 bg-secondary/30 rounded-lg hover:bg-secondary/50 transition-colors",children:[e.jsx("span",{className:"flex-1 font-medium text-sm",children:v.name}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[h.goals>0&&e.jsxs("span",{className:"flex items-center gap-1",children:["âš½ ",h.goals]}),h.own_goals>0&&e.jsxs("span",{className:"flex items-center gap-1 text-destructive",children:["ðŸ”„ ",h.own_goals]}),h.assists>0&&e.jsxs("span",{className:"flex items-center gap-1",children:["ðŸ‘Ÿ ",h.assists]}),h.yellow_cards>0&&e.jsxs("span",{children:["ðŸŸ¨ ",h.yellow_cards]}),h.red_cards>0&&e.jsxs("span",{children:["ðŸŸ¥ ",h.red_cards]})]}),r&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(_,{size:"sm",variant:"ghost",onClick:()=>y(h),className:"h-7 w-7 p-0",children:e.jsx(We,{className:"w-3 h-3"})}),e.jsx(_,{size:"sm",variant:"ghost",onClick:()=>E(h.id),className:"h-7 w-7 p-0 text-destructive",children:e.jsx(Ne,{className:"w-3 h-3"})})]})]},h.id):null},O=(h,A,v)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-display text-sm font-semibold text-foreground/80",children:A}),h.length===0?e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"ÐÐµÑ‚ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸"}):e.jsx("div",{className:"space-y-1",children:h.map(I=>z(I,x===I.id))})]});return e.jsx(yo,{open:a,onOpenChange:s,children:e.jsxs(ya,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ja,{children:e.jsx(Na,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("span",{className:"font-display text-lg",children:t.home_team.name}),e.jsxs("span",{className:"font-display font-bold text-2xl match-score px-4 py-1 rounded-lg bg-secondary/50",children:[t.home_score," : ",t.away_score]}),e.jsx("span",{className:"font-display text-lg",children:t.away_team.name})]})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mt-4",children:[O(g,t.home_team.name,t.home_team_id),O(b,t.away_team.name,t.away_team_id)]}),r&&e.jsx("div",{className:"mt-6 pt-4 border-t border-border",children:P?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(q,{value:C,onValueChange:F,children:[e.jsx(B,{children:e.jsx(H,{placeholder:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ°"})}),e.jsx(W,{children:V.map(h=>e.jsx(G,{value:h.id,children:h.name},h.id))})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"text-xs text-muted-foreground mb-1",children:"âš½ Ð“Ð¾Ð»Ñ‹"}),e.jsx(L,{type:"number",min:"0",max:"2",value:T.goals,onChange:h=>K({...T,goals:parseInt(h.target.value)||0}),className:"text-center"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"text-xs text-muted-foreground mb-1",children:"ðŸ”„ ÐÐ²Ñ‚Ð¾Ð³Ð¾Ð»"}),e.jsx(L,{type:"number",min:"0",max:"2",value:T.own_goals,onChange:h=>K({...T,own_goals:parseInt(h.target.value)||0}),className:"text-center"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"text-xs text-muted-foreground mb-1",children:"ðŸ‘Ÿ ÐŸÐ°ÑÑ‹"}),e.jsx(L,{type:"number",min:"0",value:T.assists,onChange:h=>K({...T,assists:parseInt(h.target.value)||0}),className:"text-center"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"text-xs text-muted-foreground mb-1",children:"ðŸŸ¨ Ð–Ðš"}),e.jsx(L,{type:"number",min:"0",value:T.yellow_cards,onChange:h=>K({...T,yellow_cards:parseInt(h.target.value)||0}),className:"text-center"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(U,{className:"text-xs text-muted-foreground mb-1",children:"ðŸŸ¥ ÐšÐš"}),e.jsx(L,{type:"number",min:"0",value:T.red_cards,onChange:h=>K({...T,red_cards:parseInt(h.target.value)||0}),className:"text-center"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{onClick:$,className:"flex-1",children:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ"}),e.jsx(_,{variant:"outline",onClick:()=>{w(!1),F("")},children:"ÐžÑ‚Ð¼ÐµÐ½Ð°"})]})]}):e.jsxs(_,{onClick:()=>w(!0),variant:"outline",className:"w-full",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð¸Ð³Ñ€Ð¾ÐºÐ°"]})}),e.jsx("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg text-xs text-muted-foreground",children:e.jsx("p",{children:"âš½ = Ð³Ð¾Ð», ðŸ”„ = Ð°Ð²Ñ‚Ð¾Ð³Ð¾Ð» (Ð·Ð°ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ ÑÐ¾Ð¿ÐµÑ€Ð½Ð¸ÐºÑƒ), ðŸ‘Ÿ = Ð³Ð¾Ð»ÐµÐ²Ð¾Ð¹ Ð¿Ð°Ñ, ðŸŸ¨ = Ð¶Ñ‘Ð»Ñ‚Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ°, ðŸŸ¥ = ÐºÑ€Ð°ÑÐ½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ°"})})]})})}function bo({tourId:t,tourNumber:a}){const{data:s=[]}=mt(t),[r,n]=l.useState(null),[o,i]=l.useState(!1);if(!t||s.length===0)return null;const c=o?s:s.slice(0,3),u=s.length>3;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stat-card",children:[e.jsxs("h2",{className:"text-xl font-display font-bold text-foreground tracking-wide mb-4",children:["ÐœÐ°Ñ‚Ñ‡Ð¸",a?` Ñ‚ÑƒÑ€Ð° ${a}`:""]}),e.jsx("div",{className:"space-y-2",children:c.map((p,m)=>e.jsxs("div",{onClick:()=>n(p),className:"flex items-center gap-2 sm:gap-4 py-3 px-3 sm:px-4 bg-secondary/50 rounded-lg text-sm hover:bg-secondary/70 transition-colors cursor-pointer group",children:[e.jsxs("span",{className:"text-muted-foreground font-mono text-xs shrink-0",children:["#",m+1]}),e.jsx("span",{className:"flex-1 text-right font-medium text-xs sm:text-sm truncate",children:p.home_team.name}),e.jsxs("span",{className:"shrink-0 font-display font-bold text-base sm:text-lg match-score whitespace-nowrap",children:[p.home_score,":",p.away_score]}),e.jsx("span",{className:"flex-1 text-left font-medium text-xs sm:text-sm truncate",children:p.away_team.name}),e.jsx("span",{className:"text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity hidden sm:inline",children:"â†’"})]},p.id))}),u&&e.jsx(_,{variant:"ghost",className:"w-full mt-3 text-muted-foreground hover:text-foreground",onClick:()=>i(!o),children:o?e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"w-4 h-4 mr-2"}),"Ð¡Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ"]}):e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"w-4 h-4 mr-2"}),"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²ÑÐµ (",s.length," Ð¼Ð°Ñ‚Ñ‡ÐµÐ¹)"]})})]}),e.jsx(vo,{match:r,isOpen:!!r,onClose:()=>n(null)})]})}const Lt=5;function wo({tourId:t}){const{data:a=[]}=gr(t),{data:s=[]}=Fe(),{data:r=[]}=Pe(),[n,o]=l.useState(!1),i=l.useMemo(()=>{const m=new Map;return a.forEach(x=>{var j;const f=m.get(x.player_id);if(f)f.goals+=x.goals,f.assists+=x.assists,f.yellowCards+=x.yellow_cards,f.redCards+=x.red_cards;else{const N=s.find(w=>w.id===x.player_id),P=r.find(w=>w.id===(N==null?void 0:N.team_id));m.set(x.player_id,{playerId:x.player_id,playerName:(N==null?void 0:N.name)??((j=x.player)==null?void 0:j.name)??"Unknown",teamName:(P==null?void 0:P.name)??"",teamColor:(P==null?void 0:P.color)??"black",goals:x.goals,assists:x.assists,yellowCards:x.yellow_cards,redCards:x.red_cards})}}),Array.from(m.values()).sort((x,f)=>f.goals-x.goals||f.assists-x.assists)},[a,s,r]),c=n?i:i.slice(0,Lt),u=i.length>Lt,p=m=>{switch(m){case"red":return"text-team-red";case"blue":return"text-team-blue";case"green":return"text-team-green";case"black":return"text-foreground";default:return"text-muted-foreground"}};return!t||i.length===0?e.jsxs("div",{className:"stat-card",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground font-mono mb-4",children:"Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²"}),e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ"})]}):e.jsxs("div",{className:"stat-card",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground font-mono mb-4",children:"Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border text-muted-foreground",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"#"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Ð˜Ð³Ñ€Ð¾Ðº"}),e.jsx("th",{className:"text-left py-2 px-2",children:"ÐšÐ¾Ð¼Ð°Ð½Ð´Ð°"}),e.jsx("th",{className:"text-center py-2 px-1",children:"âš½"}),e.jsx("th",{className:"text-center py-2 px-1",children:"ðŸ…°ï¸"}),e.jsx("th",{className:"text-center py-2 px-1",children:"ðŸŸ¨"}),e.jsx("th",{className:"text-center py-2 px-1",children:"ðŸŸ¥"})]})}),e.jsx("tbody",{children:c.map((m,x)=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-secondary/50 transition-colors",children:[e.jsx("td",{className:"py-2 px-2 text-muted-foreground",children:x+1}),e.jsx("td",{className:"py-2 px-2 font-medium",children:m.playerName}),e.jsx("td",{className:`py-2 px-2 ${p(m.teamColor)}`,children:m.teamName}),e.jsx("td",{className:"text-center py-2 px-1 font-mono font-bold text-primary",children:m.goals}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:m.assists}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:m.yellowCards}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:m.redCards})]},m.playerId))})]})}),u&&e.jsx("button",{onClick:()=>o(!n),className:"w-full mt-3 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors flex items-center justify-center gap-1 border-t border-border/50",children:n?e.jsxs(e.Fragment,{children:["Ð¡Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ ",e.jsx(dt,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²ÑÐµ (",i.length,") ",e.jsx(ut,{className:"w-4 h-4"})]})})]})}function _o(t,a){let s=0,r=0,n=0,o=0,i=0;return a.forEach(c=>{c.home_team_id===t.id?(o+=c.home_score,i+=c.away_score,c.home_score>c.away_score?s++:c.home_score===c.away_score?r++:n++):c.away_team_id===t.id&&(o+=c.away_score,i+=c.home_score,c.away_score>c.home_score?s++:c.away_score===c.home_score?r++:n++)}),{teamId:t.id,teamName:t.name,teamColor:t.color??"black",played:s+r+n,won:s,drawn:r,lost:n,goalsFor:o,goalsAgainst:i,goalDiff:o-i,points:s*3+r}}const Co=t=>{switch(t){case"red":return"text-team-red";case"blue":return"text-team-blue";case"green":return"text-team-green";case"black":return"text-foreground";default:return"text-muted-foreground"}};function Mo(){const{data:t=[]}=Pe(),{data:a=[]}=xt(),s=l.useMemo(()=>t.map(r=>_o(r,a)).filter(r=>r.played>0).sort((r,n)=>n.points-r.points||n.goalDiff-r.goalDiff),[t,a]);return s.length===0?e.jsxs("div",{className:"stat-card",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground font-mono mb-4",children:"ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´"}),e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ"})]}):e.jsxs("div",{className:"stat-card",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground font-mono mb-4",children:"ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border text-muted-foreground",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"#"}),e.jsx("th",{className:"text-left py-2 px-2",children:"ÐšÐ¾Ð¼Ð°Ð½Ð´Ð°"}),e.jsx("th",{className:"text-center py-2 px-1",children:"Ð˜"}),e.jsx("th",{className:"text-center py-2 px-1",children:"Ð’"}),e.jsx("th",{className:"text-center py-2 px-1",children:"Ð"}),e.jsx("th",{className:"text-center py-2 px-1",children:"ÐŸ"}),e.jsx("th",{className:"text-center py-2 px-1",children:"Ð“Ð—"}),e.jsx("th",{className:"text-center py-2 px-1",children:"Ð“ÐŸ"}),e.jsx("th",{className:"text-center py-2 px-1",children:"Ð Ð°Ð·Ð½"}),e.jsx("th",{className:"text-center py-2 px-1 text-primary",children:"ÐžÑ‡ÐºÐ¸"})]})}),e.jsx("tbody",{children:s.map((r,n)=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-secondary/50 transition-colors",children:[e.jsx("td",{className:"py-2 px-2 text-muted-foreground",children:n+1}),e.jsx("td",{className:`py-2 px-2 font-medium ${Co(r.teamColor)}`,children:r.teamName}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:r.played}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:r.won}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:r.drawn}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:r.lost}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:r.goalsFor}),e.jsx("td",{className:"text-center py-2 px-1 font-mono",children:r.goalsAgainst}),e.jsxs("td",{className:"text-center py-2 px-1 font-mono",children:[r.goalDiff>0?"+":"",r.goalDiff]}),e.jsx("td",{className:"text-center py-2 px-1 font-mono font-bold text-primary",children:r.points})]},r.teamId))})]})})]})}function So(t){return it({queryKey:["mvp-counts",t],queryFn:async()=>{if(!t)return new Map;const{data:a,error:s}=await k.from("tours").select("mvp_player_id").eq("season_id",t).not("mvp_player_id","is",null);if(s)throw s;const r=new Map;return a==null||a.forEach(n=>{n.mvp_player_id&&r.set(n.mvp_player_id,(r.get(n.mvp_player_id)||0)+1)}),r},enabled:!!t})}const zt=6;function Po(){const{isAdmin:t}=ie(),{toast:a}=Wa(),{data:s}=yr(),r=(s==null?void 0:s.stats)||[],n=(s==null?void 0:s.substitutions)||[],{data:o=[],refetch:i}=Fe(),{data:c=[]}=Pe(),{data:u=[]}=xt(),{data:p}=Se(),{data:m=[]}=_r((p==null?void 0:p.id)??null),{data:x=new Map}=So((p==null?void 0:p.id)??null),[f,j]=l.useState("points"),[N,P]=l.useState(!1),w=async(g,b)=>{if(window.confirm(`Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¸Ð³Ñ€Ð¾ÐºÐ° ${b}? Ð’ÑÐµ ÐµÐ³Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð±ÑƒÐ´ÑƒÑ‚ ÑÑ‚ÐµÑ€Ñ‚Ñ‹.`))try{const{error:y}=await k.from("players").delete().eq("id",g);if(y)throw y;a({title:"Ð˜Ð³Ñ€Ð¾Ðº ÑƒÐ´Ð°Ð»ÐµÐ½",description:`${b} ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½ Ð¸Ð· Ð±Ð°Ð·Ñ‹.`}),i()}catch(y){a({variant:"destructive",title:"ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ",description:y.message})}},C=l.useMemo(()=>{const g=new Map;return m.forEach(b=>{b.team_type==="dream"&&g.set(b.player_id,(g.get(b.player_id)||0)+1)}),g},[m]),F=l.useMemo(()=>{const g=new Set;return n.forEach(b=>{g.add(`${b.original_player_id}_${b.tour_id}`)}),g},[n]),T=l.useMemo(()=>{const g=new Map;return o.forEach(b=>{if(!b.team_id)return;let y=0;u.forEach(D=>{(D.home_team_id===b.team_id||D.away_team_id===b.team_id)&&(F.has(`${b.id}_${D.tour_id}`)||y++)}),g.set(b.id,y)}),n.forEach(b=>{const y=b.substitute_player_id,D=b.tour_id,E=o.find($=>$.id===b.original_player_id);if(E!=null&&E.team_id){const $=u.filter(O=>O.tour_id===D&&(O.home_team_id===E.team_id||O.away_team_id===E.team_id)),z=g.get(y)||0;g.set(y,z+$.length)}}),g},[o,u,F,n]),K=l.useMemo(()=>{const g=new Map;r.forEach(y=>{var $,z;const D=($=y.match)==null?void 0:$.tour_id;if(D&&F.has(`${y.player_id}_${D}`))return;const E=g.get(y.player_id);if(E)E.goals+=y.goals||0,E.assists+=y.assists||0,E.yellowCards+=y.yellow_cards||0,E.redCards+=y.red_cards||0,E.ownGoals+=y.own_goals||0;else{const O=o.find(A=>A.id===y.player_id),h=O!=null&&O.team_id?c.find(A=>A.id===O.team_id):null;g.set(y.player_id,{playerId:y.player_id,playerName:(O==null?void 0:O.name)??((z=y.player)==null?void 0:z.name)??"Unknown",teamName:(h==null?void 0:h.name)??"Ð›ÐµÐ³Ð¸Ð¾Ð½ÐµÑ€",teamColor:(h==null?void 0:h.color)??"muted",games:T.get(y.player_id)||0,goals:y.goals||0,assists:y.assists||0,yellowCards:y.yellow_cards||0,redCards:y.red_cards||0,ownGoals:y.own_goals||0,dreamTeamCount:C.get(y.player_id)||0,mvpCount:x.get(y.player_id)||0})}}),g.forEach((y,D)=>{y.games=T.get(D)||0,y.dreamTeamCount=C.get(D)||0,y.mvpCount=x.get(D)||0});const b=Array.from(g.values());return b.sort((y,D)=>{if(f==="points"){const z=y.goals+y.assists,O=D.goals+D.assists;return O!==z?O-z:D.goals-y.goals}const $={goals:"goals",assists:"assists",yellowCards:"yellowCards",redCards:"redCards",ownGoals:"ownGoals",games:"games"}[f];if($){const z=D[$]-y[$];if(z!==0)return z}return D.goals-y.goals||D.assists-y.assists}),b},[r,o,c,C,x,f,F,T]),de=N?K:K.slice(0,zt),ce=K.length>zt,ee=g=>{switch(g){case"red":return"text-team-red";case"blue":return"text-team-blue";case"green":return"text-team-green";case"black":return"text-foreground";case"muted":return"text-muted-foreground italic";default:return"text-muted-foreground"}},V=({column:g,label:b})=>e.jsx("th",{className:`text-center py-2 px-1 cursor-pointer hover:text-primary transition-colors ${f===g?"text-primary":""}`,onClick:()=>j(g),children:e.jsxs("span",{className:"inline-flex items-center gap-0.5",children:[b,f===g&&e.jsx(Sr,{className:"w-3 h-3"})]})});return e.jsxs("div",{className:"stat-card",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground font-mono mb-4",children:"ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border text-muted-foreground text-xs",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"#"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Ð˜Ð³Ñ€Ð¾Ðº"}),e.jsx("th",{className:"text-left py-2 px-2 hidden sm:table-cell",children:"ÐšÐ¾Ð¼Ð°Ð½Ð´Ð°"}),e.jsx(V,{column:"games",label:"ðŸŽ®"}),e.jsx(V,{column:"goals",label:"âš½"}),e.jsx(V,{column:"assists",label:"ðŸ…°ï¸"}),e.jsx(V,{column:"points",label:"Ð“+ÐŸ"}),e.jsx(V,{column:"ownGoals",label:"ðŸ”„"}),e.jsx(V,{column:"yellowCards",label:"ðŸŸ¨"}),e.jsx(V,{column:"redCards",label:"ðŸŸ¥"}),e.jsx("th",{className:"text-center py-2 px-1",children:"â­"}),e.jsx("th",{className:"text-center py-2 px-1",children:"ðŸ†"}),t&&e.jsx("th",{className:"text-center py-2 px-1",children:"âš™ï¸"})," "]})}),e.jsx("tbody",{children:de.map((g,b)=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-secondary/50 transition-colors",children:[e.jsx("td",{className:"py-2 px-2 text-muted-foreground text-xs font-bold",children:b+1}),e.jsxs("td",{className:"py-2 px-2 font-medium text-sm",children:[e.jsx("span",{className:"block",children:g.playerName}),e.jsx("span",{className:`sm:hidden text-xs ${ee(g.teamColor)}`,children:g.teamName})]}),e.jsx("td",{className:`py-2 px-2 hidden sm:table-cell ${ee(g.teamColor)}`,children:g.teamName}),e.jsx("td",{className:"text-center py-2 px-1 font-mono text-sm text-muted-foreground",children:g.games}),e.jsx("td",{className:"text-center py-2 px-1 font-mono font-bold text-primary text-sm",children:g.goals}),e.jsx("td",{className:"text-center py-2 px-1 font-mono text-sm",children:g.assists}),e.jsx("td",{className:"text-center py-2 px-1 font-mono font-bold text-primary text-sm",children:g.goals+g.assists}),e.jsx("td",{className:"text-center py-2 px-1 font-mono text-sm text-orange-500",children:g.ownGoals>0?g.ownGoals:"-"}),e.jsx("td",{className:"text-center py-2 px-1 font-mono text-sm",children:g.yellowCards}),e.jsx("td",{className:"text-center py-2 px-1 font-mono text-sm",children:g.redCards}),e.jsx("td",{className:"text-center py-2 px-1 font-mono text-yellow-500 text-sm",children:g.dreamTeamCount>0?g.dreamTeamCount:"-"}),e.jsx("td",{className:"text-center py-2 px-1 font-mono text-amber-500 text-sm",children:g.mvpCount>0?g.mvpCount:"-"}),t&&e.jsx("td",{className:"text-center py-2 px-1",children:e.jsx("button",{onClick:()=>w(g.playerId,g.playerName),className:"p-1.5 text-muted-foreground hover:text-destructive transition-colors rounded-md hover:bg-destructive/10",title:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¸Ð³Ñ€Ð¾ÐºÐ°",children:e.jsx(Ne,{className:"w-4 h-4"})})})]},g.playerId))})]})}),ce&&e.jsx("button",{onClick:()=>P(!N),className:"w-full mt-3 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors flex items-center justify-center gap-1 border-t border-border/50",children:N?e.jsxs(e.Fragment,{children:["Ð¡Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ ",e.jsx(dt,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²ÑÐµ (",K.length,") ",e.jsx(ut,{className:"w-4 h-4"})]})})]})}function To({tourId:t}){const{data:a=[]}=Ot(t,"dream"),{data:s=[]}=Ot(t,"anti"),r=mr(),n=l.useMemo(()=>{const i=new Array(5).fill("");return a.forEach(c=>{c.position>=1&&c.position<=5&&(i[c.position-1]=c.player_id)}),i},[a]),o=l.useMemo(()=>{const i=new Array(5).fill("");return s.forEach(c=>{c.position>=1&&c.position<=5&&(i[c.position-1]=c.player_id)}),i},[s]);return t?e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(Ft,{title:"Ð¡Ð±Ð¾Ñ€Ð½Ð°Ñ Ñ‚ÑƒÑ€Ð°",type:"dream",selectedPlayerIds:n,onSave:i=>r.mutate({tourId:t,teamType:"dream",playerIds:i.filter(Boolean)}),isPending:r.isPending}),e.jsx(Ft,{title:"ÐÐ½Ñ‚Ð¸ÑÐ±Ð¾Ñ€Ð½Ð°Ñ Ñ‚ÑƒÑ€Ð°",type:"anti",selectedPlayerIds:o,onSave:i=>r.mutate({tourId:t,teamType:"anti",playerIds:i.filter(Boolean)}),isPending:r.isPending})]}):null}function Do(){const t=oe();return le({mutationFn:async({tourId:a,videoUrl:s})=>{const{error:r}=await k.from("tours").update({video_url:s}).eq("id",a);if(r)throw r},onSuccess:()=>{t.invalidateQueries({queryKey:["tours"]}),t.invalidateQueries({queryKey:["current-tour"]}),M.success("Ð’Ð¸Ð´ÐµÐ¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾")},onError:a=>{M.error(a.message)}})}function Eo(t){if(!t)return null;const a=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(const s of a){const r=t.match(s);if(r)return r[1]}return null}function Io({videoUrl:t,tourNumber:a}){const s=Eo(t);return s?e.jsxs("div",{className:"stat-card",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground font-mono mb-4",children:["Ð’Ð¸Ð´ÐµÐ¾ Ñ‚ÑƒÑ€Ð° ",a]}),e.jsx("div",{className:"aspect-video rounded-lg overflow-hidden",children:e.jsx("iframe",{className:"w-full h-full",src:`https://www.youtube.com/embed/${s}`,title:`Ð’Ð¸Ð´ÐµÐ¾ Ñ‚ÑƒÑ€Ð° ${a}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})]}):null}function Ro(){const t=oe();return le({mutationFn:async({playerId:a,file:s})=>{const r=s.name.split(".").pop(),o=`${a}-${Date.now()}.${r}`,{error:i}=await k.storage.from("player-photos").upload(o,s,{upsert:!0});if(i)throw i;const{data:{publicUrl:c}}=k.storage.from("player-photos").getPublicUrl(o),{error:u}=await k.from("players").update({photo_url:c}).eq("id",a);if(u)throw u;return c},onSuccess:()=>{t.invalidateQueries({queryKey:["players"]}),M.success("Ð¤Ð¾Ñ‚Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾")},onError:a=>{M.error(a.message)}})}function ko(){const t=oe();return le({mutationFn:async({playerId:a,photoUrl:s})=>{const r=s.split("/"),n=r[r.length-1],{error:o}=await k.storage.from("player-photos").remove([n]);o&&console.warn("Could not delete file from storage:",o);const{error:i}=await k.from("players").update({photo_url:null}).eq("id",a);if(i)throw i},onSuccess:()=>{t.invalidateQueries({queryKey:["players"]}),M.success("Ð¤Ð¾Ñ‚Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¾")},onError:a=>{M.error(a.message)}})}function Ao(){const t=oe();return le({mutationFn:async({playerId:a,file:s,oldPhotoUrl:r})=>{if(r){const m=r.split("/"),x=m[m.length-1];await k.storage.from("player-photos").remove([x]).catch(()=>{})}const n=s.name.split(".").pop(),i=`${a}-${Date.now()}.${n}`,{error:c}=await k.storage.from("player-photos").upload(i,s,{upsert:!0});if(c)throw c;const{data:{publicUrl:u}}=k.storage.from("player-photos").getPublicUrl(i),{error:p}=await k.from("players").update({photo_url:u}).eq("id",a);if(p)throw p;return u},onSuccess:()=>{t.invalidateQueries({queryKey:["players"]}),M.success("Ð¤Ð¾Ñ‚Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾")},onError:a=>{M.error(a.message)}})}function Oo(t){return it({queryKey:["tour-substitutions",t],queryFn:async()=>{if(!t)return[];const{data:a,error:s}=await k.from("tour_player_substitutions").select(`
          *,
          original_player:players!tour_player_substitutions_original_player_id_fkey(id, name),
          substitute_player:players!tour_player_substitutions_substitute_player_id_fkey(id, name)
        `).eq("tour_id",t);if(s)throw s;return a},enabled:!!t})}function Fo(){const t=oe();return le({mutationFn:async a=>{const{data:s,error:r}=await k.from("tour_player_substitutions").insert(a).select().single();if(r)throw r;return s},onSuccess:(a,s)=>{t.invalidateQueries({queryKey:["tour-substitutions",s.tour_id]}),t.invalidateQueries({queryKey:["all-tour-substitutions"]}),M.success("Ð—Ð°Ð¼ÐµÐ½Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð°")},onError:a=>{M.error(a.message)}})}function $o(){const t=oe();return le({mutationFn:async({id:a,tourId:s})=>{const{error:r}=await k.from("tour_player_substitutions").delete().eq("id",a);if(r)throw r;return s},onSuccess:a=>{t.invalidateQueries({queryKey:["tour-substitutions",a]}),t.invalidateQueries({queryKey:["all-tour-substitutions"]}),M.success("Ð—Ð°Ð¼ÐµÐ½Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð°")},onError:a=>{M.error(a.message)}})}const Lo=Be().trim().min(2,"ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ð¾ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 2 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°").max(50,"ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°Ñ‚ÑŒ 50 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²").regex(/^[a-zA-ZÐ°-ÑÐ-Ð¯Ñ‘Ð0-9\s\-]+$/,"Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð±ÑƒÐºÐ²Ñ‹, Ñ†Ð¸Ñ„Ñ€Ñ‹, Ð¿Ñ€Ð¾Ð±ÐµÐ»Ñ‹ Ð¸ Ð´ÐµÑ„Ð¸ÑÑ‹"),zo=Be().trim().min(2,"Ð˜Ð¼Ñ Ð¸Ð³Ñ€Ð¾ÐºÐ° Ð´Ð¾Ð»Ð¶Ð½Ð¾ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 2 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°").max(50,"Ð˜Ð¼Ñ Ð¸Ð³Ñ€Ð¾ÐºÐ° Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°Ñ‚ÑŒ 50 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²").regex(/^[a-zA-ZÐ°-ÑÐ-Ð¯Ñ‘Ð\s\-\.]+$/,"Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð±ÑƒÐºÐ²Ñ‹, Ð¿Ñ€Ð¾Ð±ÐµÐ»Ñ‹, Ð´ÐµÑ„Ð¸ÑÑ‹ Ð¸ Ñ‚Ð¾Ñ‡ÐºÐ¸"),Go=dr({goals:Ie().min(0).max(2,"ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ 2 Ð³Ð¾Ð»Ð°"),own_goals:Ie().min(0).max(2,"ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ 2 Ð°Ð²Ñ‚Ð¾Ð³Ð¾Ð»Ð°"),assists:Ie().min(0).max(5,"ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ 5 Ð°ÑÑÐ¸ÑÑ‚Ð¾Ð²"),yellow_cards:Ie().min(0).max(2,"ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ 2 Ð¶Ñ‘Ð»Ñ‚Ñ‹Ðµ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸"),red_cards:Ie().min(0).max(1,"ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ 1 ÐºÑ€Ð°ÑÐ½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ°")}),Uo=Be().trim().refine(t=>t===""||/^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)[\w-]+/.test(t),"ÐÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° YouTube").optional().or(ur(""));function Ko({tourId:t}){var At;const{isAdmin:a}=ie(),{data:s}=Se(),{data:r=[]}=Qe((s==null?void 0:s.id)??null),{data:n=[]}=Pe(),{data:o=[]}=ts(t),{data:i=[]}=Fe(),{data:c=[]}=mt(t),{data:u=[]}=Oo(t),p=er(),m=tr(),x=vr(),f=br(),j=sr();ar();const N=rr(),P=jr();Nr();const w=Jt(),C=va(),F=Do(),T=Ro(),K=ko(),de=Ao(),ce=Fo(),ee=$o(),V=l.useRef(null),[g,b]=l.useState(""),[y,D]=l.useState(""),[E,$]=l.useState(""),[z,O]=l.useState(""),[h,A]=l.useState(""),[v,I]=l.useState(""),[X,te]=l.useState(""),[ue,Ce]=l.useState(""),[je,me]=l.useState(""),[se,Te]=l.useState(""),[Y,De]=l.useState(""),[Ee,ba]=l.useState(""),[et,wa]=l.useState(""),[_t,Ct]=l.useState("0"),[Mt,St]=l.useState("0"),[Pt,Tt]=l.useState("0"),[Dt,Et]=l.useState("0"),[It,Rt]=l.useState("0"),[tt,_a]=l.useState(""),ze=r.find(d=>d.id===t),Ca=d=>{var xe;const R=(xe=d.target.files)==null?void 0:xe[0];if(R&&E){const Ge=i.find(za=>za.id===E);Ge!=null&&Ge.photo_url?de.mutate({playerId:E,file:R,oldPhotoUrl:Ge.photo_url}):T.mutate({playerId:E,file:R}),$(""),V.current&&(V.current.value="")}},Ma=()=>{const d=i.find(R=>R.id===E);d!=null&&d.photo_url&&(K.mutate({playerId:E,photoUrl:d.photo_url}),$(""))},st=(At=i.find(d=>d.id===E))==null?void 0:At.photo_url;if(!a)return null;const Sa=()=>{const d=Lo.safeParse(v);if(!d.success){M.error(d.error.errors[0].message);return}p.mutate(d.data),I("")},Pa=()=>{if(!ue){M.error('Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ Ð¸Ð»Ð¸ "Ð›ÐµÐ³Ð¸Ð¾Ð½ÐµÑ€"');return}const d=zo.safeParse(X);if(!d.success){M.error(d.error.errors[0].message);return}const R=ue==="legioner"?null:ue;j.mutate({name:d.data,teamId:R}),te(""),Ce("")},Ta=()=>{!je||!t||(x.mutate({tourId:t,teamId:je}),me(""))},Da=()=>{if(!se||!Y||!t){M.error("Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð±Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹");return}if(se===Y){M.error("ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸");return}P.mutate({tour_id:t,home_team_id:se,away_team_id:Y,home_score:0,away_score:0}),Te(""),De("")},Ea=async()=>{if(!Ee||!et){M.error("Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¼Ð°Ñ‚Ñ‡ Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°");return}const d={goals:parseInt(_t)||0,own_goals:parseInt(Mt)||0,assists:parseInt(Pt)||0,yellow_cards:parseInt(Dt)||0,red_cards:parseInt(It)||0},R=Go.safeParse(d);if(!R.success){M.error(R.error.errors[0].message);return}await w.mutateAsync({match_id:Ee,player_id:et,goals:R.data.goals,own_goals:R.data.own_goals,assists:R.data.assists,yellow_cards:R.data.yellow_cards,red_cards:R.data.red_cards}),await C.mutateAsync(Ee),Ct("0"),St("0"),Tt("0"),Et("0"),Rt("0")},Ia=()=>{if(!t)return;const d=Uo.safeParse(tt);if(!d.success){M.error(d.error.errors[0].message);return}F.mutate({tourId:t,videoUrl:tt||null})},Ra=()=>{if(!t||!g||!y){M.error("Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ° Ð¸ Ð»ÐµÐ³Ð¸Ð¾Ð½ÐµÑ€Ð°");return}if(g===y){M.error("Ð˜Ð³Ñ€Ð¾ÐºÐ¸ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸");return}ce.mutate({tour_id:t,original_player_id:g,substitute_player_id:y}),b(""),D("")},ka=o.map(d=>d.team_id),Aa=n.filter(d=>!ka.includes(d.id)),at=c.find(d=>d.id===Ee),kt=at?[at.home_team_id,at.away_team_id]:[],Oa=kt.length>0?i.filter(d=>kt.includes(d.team_id)||d.team_id===null):i,Fa=i.filter(d=>d.team_id!==null),$a=i.filter(d=>d.team_id===null),La=u.map(d=>d.original_player_id);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground font-mono flex items-center gap-2",children:[e.jsx(Cr,{className:"w-5 h-5 text-primary"}),"ÐŸÐ°Ð½ÐµÐ»ÑŒ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°"]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(pe,{className:"bg-card border-border",children:[e.jsx(fe,{className:"pb-2",children:e.jsxs(he,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(nr,{className:"w-4 h-4 text-primary"}),"ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹"]})}),e.jsxs(ge,{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{placeholder:"ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹",value:v,onChange:d=>I(d.target.value),className:"bg-secondary border-border text-foreground"}),e.jsx(_,{size:"sm",onClick:Sa,disabled:p.isPending,children:e.jsx(Me,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1",children:n.map(d=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1",children:[e.jsx("span",{children:d.name}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",onClick:()=>m.mutate(d.id),children:e.jsx(Ne,{className:"w-3 h-3"})})]},d.id))})]})]}),e.jsxs(pe,{className:"bg-card border-border",children:[e.jsx(fe,{className:"pb-2",children:e.jsx(he,{className:"text-sm font-medium",children:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ Ð² Ñ‚ÑƒÑ€"})}),e.jsxs(ge,{className:"space-y-3",children:[e.jsxs(q,{value:je,onValueChange:me,children:[e.jsx(B,{className:"bg-secondary border-border",children:e.jsx(H,{placeholder:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ"})}),e.jsx(W,{children:Aa.map(d=>e.jsx(G,{value:d.id,children:d.name},d.id))})]}),e.jsx(_,{size:"sm",className:"w-full",onClick:Ta,disabled:!je||!t,children:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² Ñ‚ÑƒÑ€"}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1",children:o.map(d=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1",children:[e.jsx("span",{children:d.team.name}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",onClick:()=>f.mutate(d.id),children:e.jsx(Ne,{className:"w-3 h-3"})})]},d.id))})]})]}),e.jsxs(pe,{className:"bg-card border-border",children:[e.jsx(fe,{className:"pb-2",children:e.jsxs(he,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4 text-primary"}),"Ð˜Ð³Ñ€Ð¾ÐºÐ¸"]})}),e.jsxs(ge,{className:"space-y-3",children:[e.jsxs(q,{value:ue,onValueChange:Ce,children:[e.jsx(B,{className:"bg-secondary border-border",children:e.jsx(H,{placeholder:"ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° Ð¸Ð³Ñ€Ð¾ÐºÐ°"})}),e.jsxs(W,{children:[e.jsx(G,{value:"legioner",children:"âš¡ Ð›ÐµÐ³Ð¸Ð¾Ð½ÐµÑ€ (Ð±ÐµÐ· ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹)"}),n.map(d=>e.jsx(G,{value:d.id,children:d.name},d.id))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{placeholder:"Ð˜Ð¼Ñ Ð¸Ð³Ñ€Ð¾ÐºÐ°",value:X,onChange:d=>te(d.target.value),className:"bg-secondary border-border text-foreground"}),e.jsx(_,{size:"sm",onClick:Pa,disabled:j.isPending,children:e.jsx(Me,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"border-t border-border pt-3 mt-3",children:[e.jsx(U,{className:"text-xs text-muted-foreground mb-2 block",children:"Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð¾Ñ‚Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ°"}),e.jsx("p",{className:"text-[10px] text-muted-foreground/70 mb-2",children:"ðŸ“· Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ñ‹Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€: 300Ã—300px, Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ JPG/PNG, ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚Ð½Ð¾Ðµ Ñ„Ð¾Ñ‚Ð¾ Ð´Ð»Ñ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð² ÐºÑ€ÑƒÐ³Ðµ"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(q,{value:E,onValueChange:$,children:[e.jsx(B,{className:"bg-secondary border-border flex-1",children:e.jsx(H,{placeholder:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ°"})}),e.jsx(W,{children:i.map(d=>e.jsx(G,{value:d.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(rt,{className:"h-5 w-5",children:[e.jsx(nt,{src:d.photo_url,alt:d.name}),e.jsx(ot,{className:"text-[10px]",children:d.name[0]})]}),d.name,d.photo_url&&e.jsx("span",{className:"text-xs text-green-500",children:"âœ“"})]})},d.id))})]}),e.jsx("input",{type:"file",accept:"image/*",ref:V,onChange:Ca,className:"hidden"}),e.jsx(_,{size:"sm",variant:"outline",onClick:()=>{var d;return(d=V.current)==null?void 0:d.click()},disabled:!E||T.isPending||de.isPending,title:st?"Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ„Ð¾Ñ‚Ð¾":"Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ñ„Ð¾Ñ‚Ð¾",children:st?e.jsx(We,{className:"w-4 h-4"}):e.jsx(Pr,{className:"w-4 h-4"})}),st&&e.jsx(_,{size:"sm",variant:"destructive",onClick:Ma,disabled:K.isPending,title:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ñ„Ð¾Ñ‚Ð¾",children:e.jsx(Ne,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"border-t border-border pt-3 mt-3",children:[e.jsx(U,{className:"text-xs text-muted-foreground mb-2 block",children:"Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ Ð¸Ð³Ñ€Ð¾ÐºÐ°"}),e.jsx("div",{className:"flex gap-2 items-center",children:e.jsxs(q,{value:z,onValueChange:d=>{O(d);const R=i.find(xe=>xe.id===d);A((R==null?void 0:R.team_id)||"legioner")},children:[e.jsx(B,{className:"bg-secondary border-border flex-1",children:e.jsx(H,{placeholder:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ°"})}),e.jsx(W,{children:i.map(d=>{const R=n.find(xe=>xe.id===d.team_id);return e.jsxs(G,{value:d.id,children:[d.name," (",(R==null?void 0:R.name)||"Ð›ÐµÐ³Ð¸Ð¾Ð½ÐµÑ€",")"]},d.id)})})]})}),z&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(q,{value:h,onValueChange:A,children:[e.jsx(B,{className:"bg-secondary border-border flex-1",children:e.jsx(H,{placeholder:"ÐÐ¾Ð²Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°"})}),e.jsxs(W,{children:[e.jsx(G,{value:"legioner",children:"âš¡ Ð›ÐµÐ³Ð¸Ð¾Ð½ÐµÑ€ (Ð±ÐµÐ· ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹)"}),n.map(d=>e.jsx(G,{value:d.id,children:d.name},d.id))]})]}),e.jsx(_,{size:"sm",onClick:()=>{const d=h==="legioner"?null:h;N.mutate({id:z,teamId:d}),O(""),A("")},disabled:N.isPending,children:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"})]})]})]})]}),e.jsxs(pe,{className:"bg-card border-border",children:[e.jsx(fe,{className:"pb-2",children:e.jsx(he,{className:"text-sm font-medium",children:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¼Ð°Ñ‚Ñ‡"})}),e.jsxs(ge,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(q,{value:se,onValueChange:Te,children:[e.jsx(B,{className:"bg-secondary border-border",children:e.jsx(H,{placeholder:"Ð¥Ð¾Ð·ÑÐµÐ²Ð°"})}),e.jsx(W,{children:o.map(d=>e.jsx(G,{value:d.team_id,children:d.team.name},d.team_id))})]}),e.jsxs(q,{value:Y,onValueChange:De,children:[e.jsx(B,{className:"bg-secondary border-border",children:e.jsx(H,{placeholder:"Ð“Ð¾ÑÑ‚Ð¸"})}),e.jsx(W,{children:o.map(d=>e.jsx(G,{value:d.team_id,children:d.team.name},d.team_id))})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ð¡Ñ‡Ñ‘Ñ‚ Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¸Ð· ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²"}),e.jsx(_,{size:"sm",className:"w-full",onClick:Da,children:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¼Ð°Ñ‚Ñ‡"})]})]}),e.jsxs(pe,{className:"bg-card border-border md:col-span-2",children:[e.jsx(fe,{className:"pb-2",children:e.jsx(he,{className:"text-sm font-medium",children:"Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸Ð³Ñ€Ð¾ÐºÐ°"})}),e.jsxs(ge,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(q,{value:Ee,onValueChange:ba,children:[e.jsx(B,{className:"bg-secondary border-border",children:e.jsx(H,{placeholder:"ÐœÐ°Ñ‚Ñ‡"})}),e.jsx(W,{children:c.map(d=>e.jsxs(G,{value:d.id,children:[d.home_team.name," vs ",d.away_team.name]},d.id))})]}),e.jsxs(q,{value:et,onValueChange:wa,children:[e.jsx(B,{className:"bg-secondary border-border",children:e.jsx(H,{placeholder:"Ð˜Ð³Ñ€Ð¾Ðº"})}),e.jsx(W,{children:Oa.map(d=>e.jsx(G,{value:d.id,children:d.name},d.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[e.jsxs("div",{children:[e.jsx(U,{className:"text-xs text-muted-foreground",children:"âš½ Ð“Ð¾Ð»Ñ‹ (Ð¼Ð°ÐºÑ. 2)"}),e.jsx(L,{type:"number",min:"0",max:"2",value:_t,onChange:d=>Ct(d.target.value),className:"bg-secondary border-border text-foreground text-center"})]}),e.jsxs("div",{children:[e.jsx(U,{className:"text-xs text-muted-foreground",children:"ðŸ”„ ÐÐ²Ñ‚Ð¾Ð³Ð¾Ð»"}),e.jsx(L,{type:"number",min:"0",max:"2",value:Mt,onChange:d=>St(d.target.value),className:"bg-secondary border-border text-foreground text-center"})]}),e.jsxs("div",{children:[e.jsx(U,{className:"text-xs text-muted-foreground",children:"ðŸ‘Ÿ ÐŸÐ°ÑÑ‹"}),e.jsx(L,{type:"number",min:"0",value:Pt,onChange:d=>Tt(d.target.value),className:"bg-secondary border-border text-foreground text-center"})]}),e.jsxs("div",{children:[e.jsx(U,{className:"text-xs text-muted-foreground",children:"ðŸŸ¨ Ð–Ðš"}),e.jsx(L,{type:"number",min:"0",value:Dt,onChange:d=>Et(d.target.value),className:"bg-secondary border-border text-foreground text-center"})]}),e.jsxs("div",{children:[e.jsx(U,{className:"text-xs text-muted-foreground",children:"ðŸŸ¥ ÐšÐš"}),e.jsx(L,{type:"number",min:"0",value:It,onChange:d=>Rt(d.target.value),className:"bg-secondary border-border text-foreground text-center"})]})]}),e.jsx(_,{size:"sm",className:"w-full",onClick:Ea,disabled:w.isPending||C.isPending,children:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ"})]})]}),e.jsxs(pe,{className:"bg-card border-border",children:[e.jsx(fe,{className:"pb-2",children:e.jsxs(he,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ir,{className:"w-4 h-4 text-primary"}),"Ð’Ð¸Ð´ÐµÐ¾ Ñ‚ÑƒÑ€Ð°"]})}),e.jsxs(ge,{className:"space-y-3",children:[e.jsx(L,{placeholder:"YouTube URL",value:tt,onChange:d=>_a(d.target.value),className:"bg-secondary border-border text-foreground"}),(ze==null?void 0:ze.video_url)&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["Ð¢ÐµÐºÑƒÑ‰ÐµÐµ: ",ze.video_url]}),e.jsx(_,{size:"sm",className:"w-full",onClick:Ia,disabled:!t||F.isPending,children:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð²Ð¸Ð´ÐµÐ¾"})]})]}),e.jsxs(pe,{className:"bg-card border-border md:col-span-2",children:[e.jsx(fe,{className:"pb-2",children:e.jsxs(he,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Mr,{className:"w-4 h-4 text-primary"}),"Ð—Ð°Ð¼ÐµÐ½Ñ‹ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² (Ð»ÐµÐ³Ð¸Ð¾Ð½ÐµÑ€Ñ‹)"]})}),e.jsxs(ge,{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ, ÐºÐ°ÐºÐ¾Ð³Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ° Ð·Ð°Ð¼ÐµÐ½ÑÐµÑ‚ Ð»ÐµÐ³Ð¸Ð¾Ð½ÐµÑ€ Ð² ÑÑ‚Ð¾Ð¼ Ñ‚ÑƒÑ€Ðµ. ÐŸÑ€Ð¾Ð¿ÑƒÑÐºÐ°ÑŽÑ‰ÐµÐ¼Ñƒ Ð¸Ð³Ñ€Ð¾ÐºÑƒ Ð½Ðµ Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð°ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ Ð¸Ð³Ñ€Ñ‹."}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(q,{value:g,onValueChange:b,children:[e.jsx(B,{className:"bg-secondary border-border",children:e.jsx(H,{placeholder:"ÐŸÑ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ñ‚ÑƒÑ€"})}),e.jsx(W,{children:Fa.filter(d=>!La.includes(d.id)).map(d=>{const R=n.find(xe=>xe.id===d.team_id);return e.jsxs(G,{value:d.id,children:[d.name," (",(R==null?void 0:R.name)||"Ð‘ÐµÐ· ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹",")"]},d.id)})})]}),e.jsxs(q,{value:y,onValueChange:D,children:[e.jsx(B,{className:"bg-secondary border-border",children:e.jsx(H,{placeholder:"Ð›ÐµÐ³Ð¸Ð¾Ð½ÐµÑ€"})}),e.jsx(W,{children:$a.map(d=>e.jsxs(G,{value:d.id,children:["âš¡ ",d.name]},d.id))})]})]}),e.jsx(_,{size:"sm",className:"w-full",onClick:Ra,disabled:!t||!g||!y||ce.isPending,children:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¼ÐµÐ½Ñƒ"}),u.length>0&&e.jsxs("div",{className:"border-t border-border pt-3 mt-3 space-y-2",children:[e.jsx(U,{className:"text-xs text-muted-foreground",children:"Ð¢ÐµÐºÑƒÑ‰Ð¸Ðµ Ð·Ð°Ð¼ÐµÐ½Ñ‹:"}),u.map(d=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1 bg-secondary/50 px-2 rounded",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-muted-foreground",children:d.original_player.name}),e.jsx("span",{className:"mx-2",children:"â†’"}),e.jsxs("span",{className:"text-primary font-medium",children:["âš¡ ",d.substitute_player.name]})]}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",onClick:()=>ee.mutate({id:d.id,tourId:t}),children:e.jsx(Ne,{className:"w-3 h-3"})})]},d.id))]})]})]})]})]})}function Vo(){return it({queryKey:["admins"],queryFn:async()=>{const{data:t,error:a}=await k.from("user_roles").select("*").order("created_at");if(a)throw a;const s=t.map(o=>o.user_id),{data:r}=await k.from("profiles").select("user_id, email").in("user_id",s),n=new Map((r==null?void 0:r.map(o=>[o.user_id,o.email]))||[]);return t.map(o=>({...o,email:n.get(o.user_id)||"Unknown"}))}})}function qo(){const t=oe();return le({mutationFn:async a=>{const{data:s,error:r}=await k.from("profiles").select("user_id").eq("email",a).maybeSingle();if(r)throw r;if(!s)throw new Error("ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½");const{data:n}=await k.from("user_roles").select("*").eq("user_id",s.user_id).maybeSingle();if(n)throw new Error("ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑƒÐ¶Ðµ ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼");const{data:o,error:i}=await k.from("user_roles").insert({user_id:s.user_id,role:"admin"}).select().single();if(i)throw i;return o},onSuccess:()=>{t.invalidateQueries({queryKey:["admins"]}),M.success("ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½")},onError:a=>{M.error(a.message)}})}function Bo(){const t=oe();return le({mutationFn:async a=>{const{error:s}=await k.from("user_roles").delete().eq("id",a);if(s)throw s},onSuccess:()=>{t.invalidateQueries({queryKey:["admins"]}),M.success("ÐŸÑ€Ð°Ð²Ð° Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹")},onError:a=>{M.error(a.message)}})}const Ho=Be().email("ÐÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ email");function Wo(){const{isOwner:t}=ie(),{data:a=[]}=Vo(),s=qo(),r=Bo(),[n,o]=l.useState("");if(!t)return null;const i=()=>{const c=Ho.safeParse(n);if(!c.success){M.error(c.error.errors[0].message);return}s.mutate(n),o("")};return e.jsxs(pe,{className:"bg-card border-border",children:[e.jsx(fe,{className:"pb-2",children:e.jsxs(he,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(or,{className:"w-4 h-4 text-primary"}),"Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°Ð¼Ð¸"]})}),e.jsxs(ge,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{type:"email",placeholder:"Email Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ",value:n,onChange:c=>o(c.target.value),className:"bg-secondary border-border text-foreground"}),e.jsxs(_,{size:"sm",onClick:i,disabled:s.isPending,children:[e.jsx(ss,{className:"w-4 h-4 mr-1"}),"ÐÐ°Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÑŒ"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ð¢ÐµÐºÑƒÑ‰Ð¸Ðµ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñ‹:"}),a.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"ÐÐµÑ‚ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²"}):e.jsx("div",{className:"space-y-1",children:a.map(c=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1 px-2 bg-secondary/50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:c.email}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${c.role==="owner"?"bg-primary/20 text-primary":"bg-muted text-muted-foreground"}`,children:c.role==="owner"?"Owner":"Admin"})]}),c.role!=="owner"&&e.jsx(_,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",onClick:()=>r.mutate(c.id),children:e.jsx(Ne,{className:"w-3 h-3"})})]},c.id))})]})]})]})}function Qo(){const{data:t}=Se(),{data:a=[]}=Qe((t==null?void 0:t.id)??null),{data:s=[]}=xt(),r=a[0],n=r?s.filter(o=>o.tour_id===r.id).slice(0,6):[];return n.length===0?null:e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-r from-pitch/20 via-pitch/10 to-pitch/20 border-y border-primary/30",children:[e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(90deg,transparent_0%,hsl(var(--primary)/0.05)_50%,transparent_100%)] animate-shimmer"}),e.jsx("div",{className:"relative py-3",children:e.jsxs("div",{className:"flex items-center gap-4 animate-scroll-left",children:[e.jsxs("div",{className:"flex items-center gap-2 shrink-0 px-4 border-r border-primary/30",children:[e.jsx(es,{className:"w-4 h-4 text-accent"}),e.jsxs("span",{className:"font-display text-sm text-accent",children:["Ð¢Ð£Ð  ",r==null?void 0:r.number]})]}),e.jsx("div",{className:"flex gap-4 sm:gap-8 items-center",children:[...n,...n].map((o,i)=>e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 shrink-0",children:[e.jsx("span",{className:"text-xs sm:text-sm font-medium text-foreground/80 max-w-[60px] sm:max-w-none truncate",children:o.home_team.name}),e.jsxs("span",{className:"font-display font-bold text-sm sm:text-lg match-score whitespace-nowrap",children:[o.home_score,":",o.away_score]}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-foreground/80 max-w-[60px] sm:max-w-none truncate",children:o.away_team.name}),e.jsx("span",{className:"text-muted-foreground/50 mx-2 sm:mx-4",children:"â€¢"})]},`${o.id}-${i}`))})]})})]})}const Yo="/HFC/assets/futsal-field-bg-DIaJKxAr.jpg",Xo=l.memo(lr),Zo=l.memo(Qo),Jo=l.memo(Rr),el=l.memo(kr),tl=l.memo(Or),sl=l.memo(ao),al=l.memo(bo),rl=l.memo(wo),nl=l.memo(Mo),ol=l.memo(Po),ll=l.memo(To),cl=l.memo(Io),il=l.memo(Ko),dl=l.memo(Wo),Cl=()=>{const{isAdmin:t,isOwner:a}=ie(),{data:s,isLoading:r,error:n}=Se(),{data:o=[],isLoading:i,error:c}=Qe((s==null?void 0:s.id)??null),[u,p]=l.useState(null),[m,x]=l.useState(null);l.useEffect(()=>{if((s==null?void 0:s.id)!==m){x((s==null?void 0:s.id)??null),p(null);return}o.length>0&&u===null&&p(o[0].id)},[o,u,s==null?void 0:s.id,m]);const f=l.useMemo(()=>o.find(j=>j.id===u),[o,u]);return r||s&&i?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…..."})]})}):n||c?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4 p-8 bg-destructive/10 rounded-lg border border-destructive/20",children:[e.jsx("p",{className:"text-destructive font-medium",children:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(n==null?void 0:n.message)||(c==null?void 0:c.message)||"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:"ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ"})]})}):e.jsxs("div",{className:"min-h-screen bg-background relative",children:[e.jsx("div",{className:"fixed inset-0 z-0 opacity-[0.03] pointer-events-none",style:{backgroundImage:`url(${Yo})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(Xo,{}),e.jsx(Zo,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8 space-y-8",children:[e.jsxs("div",{className:"text-center space-y-3 hero-gradient py-8",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-display font-bold text-foreground tracking-wide",children:["HFC ",e.jsx("span",{className:"gradient-text",children:"Football Stats"})]}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²"})]}),e.jsx("section",{children:e.jsx(Jo,{})}),f&&e.jsx("section",{children:e.jsx(tl,{tourId:u,mvpPlayerId:f.mvp_player_id,tourNumber:f.number})}),s&&e.jsx("section",{className:"flex items-center justify-between",children:e.jsx(el,{selectedTourId:u,onTourChange:p})}),e.jsx("section",{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(sl,{tourId:u}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(al,{tourId:u,tourNumber:f==null?void 0:f.number}),e.jsx(rl,{tourId:u})]})]})}),(f==null?void 0:f.video_url)&&e.jsx("section",{children:e.jsx(cl,{videoUrl:f.video_url,tourNumber:f.number})}),e.jsx("section",{children:e.jsx(ll,{tourId:u})}),e.jsx("section",{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(nl,{}),e.jsx(ol,{})]})}),t&&e.jsxs("section",{className:"space-y-4 pt-8 border-t border-border",children:[e.jsx(il,{tourId:u}),a&&e.jsx("div",{className:"max-w-md",children:e.jsx(dl,{})})]})]}),e.jsx("footer",{className:"border-t border-border py-6 mt-12",children:e.jsx("div",{className:"container mx-auto px-4 text-center text-sm text-muted-foreground",children:e.jsxs("p",{children:["HFC Football Stats Â© ",new Date().getFullYear()]})})})]})]})};export{Cl as default};
